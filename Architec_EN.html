<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Account (VA) System Master Architecture</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; color: #1f2937; line-height: 1.6; scroll-behavior: smooth; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; background-color: #ffffff; box-shadow: 0 0 20px rgba(0, 0, 0, 0.05); position: relative; }

        /* Custom Header Styles */
        .main-header { 
            color: #047857; 
            font-weight: 800; 
            text-transform: uppercase; 
            font-size: 1.75rem; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            margin-top: 0.5rem; 
            margin-bottom: 1.5rem; 
            border-bottom: 4px solid #10b981; 
            padding-bottom: 1rem;
        }
        
        .sub-header {
            font-size: 1.35rem; 
            font-weight: 700; 
            color: #1f2937; 
            margin-top: 2.5rem; 
            margin-bottom: 1rem; 
            border-left: 5px solid #3b82f6; 
            padding-left: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            scroll-margin-top: 20px;
        }

        .section-header {
            font-size: 1.15rem; 
            font-weight: 600; 
            color: #374151; 
            margin-top: 1.5rem; 
            margin-bottom: 0.5rem; 
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #e5e7eb;
            scroll-margin-top: 20px;
        }

        /* Image Box Styles */
        .image-container {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative; /* For hover effect context */
        }
        
        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
            cursor: zoom-in; /* Indicate zoomable */
        }

        .image-container:hover img {
            opacity: 0.95;
        }

        .image-caption {
            background-color: #f9fafb;
            padding: 0.75rem;
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
            font-style: italic;
        }

        /* Modal / Lightbox Styles */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            padding-top: 50px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.85); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 1200px;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation-name: zoom;
            animation-duration: 0.3s;
        }

        @keyframes zoom {
            from {transform:scale(0.8); opacity: 0;} 
            to {transform:scale(1); opacity: 1;}
        }

        .close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 1001;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* Caption inside modal */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }

        .summary-block {
            background-color: #ecfdf5;
            border: 2px solid #10b981;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }

        .summary-title {
            color: #047857;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #6ee7b7;
        }

        .group-title {
            color: #1d4ed8;
            font-weight: 700;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .diagram-list li {
            margin-left: 1.5rem;
            list-style: disc;
            margin-top: 0.25rem;
        }

        /* TOC Styles */
        .toc-container {
            background-color: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .toc-title {
            font-weight: 700;
            font-size: 1.125rem;
            color: #111827;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .toc-list li {
            margin-bottom: 0.5rem;
        }
        .toc-list a {
            text-decoration: none;
            color: #3b82f6;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        .toc-list a:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        .toc-sublist {
            list-style: none;
            padding-left: 1.5rem;
            margin-top: 0.25rem;
        }
        .toc-sublist li {
            margin-bottom: 0.25rem;
            border-left: 2px solid #e5e7eb;
            padding-left: 0.75rem;
        }
        .toc-sublist a {
            color: #4b5563;
            font-size: 0.9rem;
        }
        .toc-sublist a:hover {
            color: #111827;
        }

        /* Scroll Top Button */
        #scrollTopBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: #2563eb;
            color: white;
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }
        #scrollTopBtn:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        #scrollTopBtn.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
		
		
		
		      body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; padding: 24px; background-color: #ffffff; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); min-height: 100vh; }
        
        /* Typography Header */
        h1.main-title {
            color: #065f46; /* emerald-800 */
            font-size: 1.6rem;
            font-weight: 800;
            text-align: center;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            border-bottom: 4px solid #10b981;
            padding-bottom: 1rem;
            line-height: 1.4;
        }
        
        /* Section Styling */
        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e3a8a; /* blue-900 */
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-left: 5px solid #3b82f6;
            padding-left: 1rem;
        }

        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            height: 100%;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: #93c5fd;
            transform: translateY(-2px);
        }

        .feature-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .feature-list li::before {
            content: "•";
            color: #10b981;
            font-weight: bold;
            position: absolute;
            left: 0;
            font-size: 1.2rem;
            line-height: 1.5rem;
        }

        /* Logic Card for Sub-services */
        .logic-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-left: 4px solid #6366f1; /* Indigo left border default */
            border-radius: 0.5rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        .logic-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .logic-card h4 { font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem; }

        /* Scroll to top */
        #scrollUpBtn {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 99;
            background-color: #059669;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #scrollUpBtn:hover { background-color: #047857; }
        
        /* Badges */
        .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; white-space: nowrap; margin-left: auto; }
        .badge-core { background-color: #fee2e2; color: #991b1b; } /* Red */
        
        /* TOC */
        .toc-container { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 2rem; }
        .toc-link { color: #475569; font-size: 0.95rem; transition: color 0.2s; display: block; padding: 2px 0; }
        .toc-link:hover { color: #2563eb; text-decoration: underline; }
		
		
    </style>
</head>
<body>

<div class="container">

    <!-- LANGUAGE SWITCHER -->
    <div class="flex justify-end pt-4 px-4 gap-2">
        <button class="text-xs font-bold px-2 py-1 rounded bg-gray-200 text-gray-700 cursor-not-allowed">Tiếng Việt</button>
        <button class="text-xs font-bold px-2 py-1 rounded bg-green-200 text-green-800 cursor-default">English</button>
    </div>

    <!-- ==================================================================================== -->
    <!-- CONTENT ENGLISH -->
    <!-- ==================================================================================== -->
    <div id="content-en">
        <header class="text-center py-6">
            <h1 class="main-header justify-center">Virtual Account System Architecture Design</h1>
        </header>

        <!-- TABLE OF CONTENTS -->
        <div class="toc-container">
            <div class="toc-title"><i data-lucide="list" class="w-5 h-5"></i> Table of Contents</div>
            <ul class="toc-list">
                <li>
                    <a href="#group-1">I. Group 1 – Macro Architecture Diagrams</a>
                    <ul class="toc-sublist">
                        <li><a href="#diag-1">1.Diagram 1 - Overall System Landscape</a></li>
                        <li><a href="#diag-2">2.Diagram 1 - Logical Architecture</a></li>
                        <li><a href="#diag-10">3.Diagram 10 - Data Model VA (ERD)</a></li>
                        <li><a href="#diag-11">4. Diagram 11 - Deployment Architecture</a></li>
                        <li><a href="#diag-12">5. Diagram 12- Integration Architecture</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#group-2">II. Group 2 – Logical Architecture & Business Process Flow Diagrams</a>
                    <ul class="toc-sublist">
                        <li><a href="#diag-3">6.Diagram 3 - VA-first Incoming Flow</a></li>
                        <li><a href="#diag-4">7.Diagram 4 - DDA-first Incoming Flow</a></li>
                        <li><a href="#diag-5">8.Diagram 5 - Outgoing from VA</a></li>
                        <li><a href="#diag-6">9.Diagram 6 - Interest Allocation Flow</a></li>
                        <li><a href="#diag-7">10.Diagram 7 - Sequence VA-first (Seq)</a></li>
                        <li><a href="#diag-8">11.Diagram 8 - Sequence Outgoing VA(Seq)</a></li>
                        <li><a href="#diag-9">12.Diagram 9 - Sequence Interest Allocation</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- SUMMARY BLOCK -->
        <div class="summary-block">
            <div class="summary-title">KNOWLEDGE SYNTHESIS OF 12 ARCHITECTURAL DIAGRAMS & PROCESSES</div>
            <p class="text-gray-700 mb-4">
                All 12 diagrams are divided into <strong>2 major groups</strong> by purpose:
            </p>
            
            <div class="group-title text-indigo-700">I. Group 1 – Macro Architecture Diagrams</div>
            <p class="text-sm text-gray-600 italic">Consists of 4 diagrams: Diagram #1, #2, #10, #11</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Group Purpose</p>
                <ul class="diagram-list">
                    <li>Present the overall system picture (landscape)</li>
                    <li>Demonstrate the boundary between Core Banking and Deposit Core Hub</li>
                    <li>Serve as the basis for Architecture Council and Board of Directors approval</li>
                    <li>Help all technical teams (Core, Integration, Digital Channels, BA/Dev/QA) understand system operations at an architectural level</li>
                </ul>
                <p class="font-medium mt-2">2. List of diagrams in group</p>
                <ul class="diagram-list">
                    <li><a href="#diag-1" class="font-semibold text-green-700 hover:underline">Diagram #1 – Overall System Landscape / Core Banking Super Layer:</a> Introduces the BIG PICTURE of the entire system. Layers: Channels → API Gateway → Routing Hub → Deposit Core Hub → Core Banking → Data Layer. Specifies which layer VA belongs to and what the Core does. Must-have.</li>
                    <li><a href="#diag-2" class="font-semibold text-green-700 hover:underline">Diagram #2 – Logical Architecture (Deposit Core Hub + VA):</a> Describes main modules: Routing Hub, VA Engine, DDA Handler, Interest Engine. Logical boundary between Hub and Core. Explains the responsibility of each component. Must-have.</li>
                    <li><a href="#diag-10" class="font-semibold text-green-700 hover:underline">Diagram #10 – Data Model VA (ERD):</a> Overview ERD: VA, VA Ledger, VA Balance, Hierarchy, Enrollment, Identifier… Shows how VA data is organized. Must-have.</li>
                    <li><a href="#diag-11" class="font-semibold text-green-700 hover:underline">Diagram #11 – Detailed Logical ERD:</a> A more in-depth version of the Overview ERD (Diagram #10). Fully shows relationships between tables and logical modules. Very useful for Data, BA, and Dev teams. Should-have.</li>
                </ul>
            </div>

            <div class="group-title text-indigo-700">II. Group 2 – Logical Architecture & Business Process Flow Diagrams</div>
            <p class="text-sm text-gray-600 italic">Consists of 8 diagrams: #3 → #9 + #12 (Where #7, #8, #9 are Sequence Diagrams)</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Group Purpose</p>
                <ul class="diagram-list">
                    <li>Detail each business flow that Virtual Account must support</li>
                    <li>Demonstrate interactions between system components</li>
                    <li>Help BA/Dev/QA teams build, test, and report on the system</li>
                    <li>Ensure business cases meet international VA standards</li>
                </ul>
                <p class="font-medium mt-2">2. List of diagrams in group</p>
                <ul class="diagram-list">
                    <li><a href="#diag-3" class="font-semibold text-red-700 hover:underline">Diagram #3 – VA-first Incoming Flow:</a> Flow when a customer enters the VA number directly. Routing → Validate VA → Core Accounting → Event → Shadow Posting. International standard, ensures no "lost" VAs. Must-have.</li>
                    <li><a href="#diag-4" class="font-semibold text-red-700 hover:underline">Diagram #4 – DDA-first Incoming Flow:</a> When a customer only enters the DDA number + remark. Core credits first → Routing Hub finds VA → VA shadow posts. Supports inter-bank channels that do not support VA directly. Must-have.</li>
                    <li><a href="#diag-5" class="font-semibold text-red-700 hover:underline">Diagram #5 – Outgoing from VA:</a> VA controls balance → Shadow Debit → Core Debit DDA → Confirm. Suitable for POBO, paying on behalf, transfers from VA. Must-have.</li>
                    <li><a href="#diag-6" class="font-semibold text-red-700 hover:underline">Diagram #6 – Interest Allocation Flow:</a> Core calculates interest on DDA → Routing Hub → VA Alloc Engine → Shadow Posting. Supports interest sharing models by project/household/unit. Should-have.</li>
                    <li><a href="#diag-7" class="font-semibold text-red-700 hover:underline">Diagram #7 – Sequence VA-first:</a> Sequence Diagram describing sequential interaction (of Diagram #3). Serves Dev/QA for building APIs & error handling. Should-have.</li>
                    <li><a href="#diag-8" class="font-semibold text-red-700 hover:underline">Diagram #8 – Sequence Outgoing VA:</a> Entire logic of spending from VA in a sequential flow (of Diagram #5). Helps technical teams control pending/confirmed debits. Should-have.</li>
                    <li><a href="#diag-9" class="font-semibold text-red-700 hover:underline">Diagram #9 – Sequence Interest Allocation:</a> Details calculation and interest allocation (of Diagram #6). Supports audits and reconciliation. Should-have.</li>
                    <li><a href="#diag-12" class="font-semibold text-red-700 hover:underline">Diagram #12 – Integration & Deployment Architecture:</a> Describes actual deployment: containers, scaling, HA/DR. Important for DevOps and infrastructure. Must-have.</li>
                </ul>
            </div>
        </div>

        <h2 id="group-1" class="sub-header">
            <i data-lucide="layout-grid" class="w-6 h-6 text-blue-500"></i>
            I. Group 1 – Macro Architecture Diagrams
        </h2>
        <p class="pl-2 text-gray-700 italic">These diagrams present the overall system landscape, logical architecture, and data layer (Diagrams #1, #2, #10, #11).</p>

        <!-- Diagram 1 -->
        <div id="diag-1" class="section-header">1. Diagram #1 – Overall System Landscape / Core Banking Super Layer</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/01_Overall_System_Landscape.png" alt="Overall System Landscape">
            <div class="image-caption">Diagram 1/12: Overall System Landscape / Core Banking Super Layer (Click to zoom)</div>
        </div>
        
     <!-- 1. FRONTEND - API GATEWAY -->
    <section id="sec-1">
        <h2 class="section-title">
            <i data-lucide="monitor" class="text-blue-600"></i>
            1. User Layer – FrontEnd – API Gateway
        </h2>
        <div class="card bg-gray-50 border-gray-200">
            <p class="mb-2 text-gray-700">Users (Corporate, Internal, H2H, File upload) access the system via Internet/LAN through FE Portals.</p>
            <ul class="feature-list text-sm text-gray-600">
                <li>All requests are standardized, authenticated, and orchestrated through the <strong>API Gateway/ESB</strong> before entering the Deposit Core Hub layer.</li>
                <li>Some batch/file operations are transferred directly by FE to S3 for processing via ETL/MIS or backend processes.</li>
            </ul>
        </div>
    </section>

    <!-- 2. DEPOSIT CORE HUB -->
    <section id="sec-2">
        <h2 class="section-title">
            <i data-lucide="layers" class="text-blue-600"></i>
            2. Deposit Core Hub – Domain Service Layer
        </h2>
        <div class="bg-indigo-50 p-4 rounded-lg mb-6 border border-indigo-200">
            <h3 class="font-bold text-indigo-900 text-lg mb-1 flex items-center gap-2">
                <i data-lucide="disc" class="w-5 h-5"></i> Center of the Architecture
            </h3>
            <p class="text-sm text-gray-700">Designed as an independent domain service, consisting of multiple specialized microservices. These microservices coordinate to process transaction flows synchronously, manage products, manage data, and ensure business integrity.</p>
        </div>

        <div class="grid grid-cols-1 gap-4">
            
            <!-- 2.1 Sub-Account Service -->
            <div id="sec-2-1" class="logic-card border-l-purple-500 bg-purple-50 bg-opacity-30">
                <div class="flex justify-between items-start">
                    <h4><i data-lucide="users" class="w-5 h-5 text-purple-600 mt-1"></i> 2.1 Sub-Account Service (Virtual Account Service – VA/Sub-account Layer)</h4>
                    <span class="badge badge-core">Core</span>
                </div>
                <p class="text-sm text-gray-600 mb-3 italic">This is the most core component, representing all virtual account/sub-account operations.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="bg-white p-3 rounded border border-purple-100">
                        <strong class="text-purple-800 block mb-1">Virtual Account Registry & Hierarchy</strong>
                        <p class="text-gray-600 text-xs">Manage VA/Sub-account catalog, multi-level structure (2–4 levels), registry metadata (household_id, project_code,...), VA ↔ DDA mapping, and status (Active/Locked/Closed).</p>
                    </div>
                    <div class="bg-white p-3 rounded border border-purple-100">
                        <strong class="text-purple-800 block mb-1">VA Validation & Policy Control</strong>
                        <p class="text-gray-600 text-xs">Validate VA before transaction processing: status, business rules (credit/debit), limits, context. Mandatory input for VA-first flow.</p>
                    </div>
                    <div class="bg-white p-3 rounded border border-purple-100">
                        <strong class="text-purple-800 block mb-1">DDA Enrollment & Mapping</strong>
                        <p class="text-gray-600 text-xs">Manage DDA registration for VA products; rules to identify VA from DDA + remark for DDA-first flow (when customers only input the original account number).</p>
                    </div>
                    <div class="bg-white p-3 rounded border border-purple-100">
                        <strong class="text-purple-800 block mb-1">Reconciliation & Exception Handling</strong>
                        <p class="text-gray-600 text-xs">Reconcile Shadow Ledger ↔ Core Ledger data; handle transaction discrepancies, missing entries, amount mismatches, support manual investigation.</p>
                    </div>
                </div>
                <div class="bg-white p-3 rounded border border-purple-100 mt-4 text-sm">
                    <strong class="text-purple-800 block mb-1">VA Reporting & Statement</strong>
                    <p class="text-gray-600 text-xs">Generate reports and statements by VA, by VA tree (roll-up), by DDA, by project, or by accumulation product.</p>
                    <p class="text-xs text-purple-700 mt-1 font-semibold">Sub-Account Service is the "business heart" of the Virtual Account service.</p>
                </div>
            </div>

            <!-- 2.2 Transaction Service -->
            <div id="sec-2-2" class="logic-card border-l-blue-500">
                <h4><i data-lucide="arrow-left-right" class="w-5 h-5 text-blue-600 mt-1"></i> 2.2 Transaction Service (Transaction Orchestration & Shadow Posting)</h4>
                <p class="text-sm text-gray-600 mb-2">Receives transaction requests from Routing Service and performs three groups of tasks:</p>
                <ul class="text-sm text-gray-600 feature-list">
                    <li><strong>VA Posting & Shadow Ledger:</strong> Write Shadow Posting (Credit/Debit), create pending/completed/reversed status, link coreTxnId to ensure idempotency.</li>
                    <li><strong>VA Outgoing Payment:</strong> Process payments from VA (Check real/roll-up balance; Create shadow debit; Send DDA debit to Core; Receive Debit Notification Event; Finalize ledger status). Supports POBO, Payroll.</li>
                    <li><strong>Other Deposit Product Transactions:</strong> Open/close Accumulation Deposit items, early withdrawal, term extension, product conversion.</li>
                </ul>
            </div>

            <!-- 2.3 Balance Service -->
            <div class="logic-card border-l-green-500">
                <h4><i data-lucide="scale" class="w-5 h-5 text-green-600 mt-1"></i> 2.3 Balance Service (Balance – Limit – ADB)</h4>
                <ul class="text-xs text-gray-600 list-disc ml-4 space-y-1">
                    <li>Calculate Available, Pending, Roll-up balance for each VA/Sub-account.</li>
                    <li>Provide EOD and Average Daily Balance (ADB) — input for Interest Allocation.</li>
                    <li>Check limits by customer, channel, VA, DDA, or product.</li>
                </ul>
            </div>

            <!-- 2.4 Interest Allocation -->
            <div class="logic-card border-l-amber-500">
                <h4><i data-lucide="pie-chart" class="w-5 h-5 text-amber-600 mt-1"></i> 2.4 Job – Interest Allocation (Interest Batch – Allocation)</h4>
                <ul class="text-xs text-gray-600 list-disc ml-4 space-y-1">
                    <li>Receive real interest info from Core on DDA.</li>
                    <li>Calculate allocated interest for each VA/Sub-account based on ratio (pro-rata), weight, or rules.</li>
                    <li>Write Interest Shadow Posting and update roll-up balance.</li>
                    <li>Especially important for Accumulation Deposit products.</li>
                </ul>
            </div>

            <!-- 2.5 Top-Up Service -->
            <div class="logic-card border-l-cyan-500">
                <h4><i data-lucide="download" class="w-5 h-5 text-cyan-600 mt-1"></i> 2.5 Top-Up Service (Top-up – Deposit Addition)</h4>
                <p class="text-xs text-gray-600">Supports top-up operations for accumulation deposit products. Each top-up is recorded as a "small deposit item" within the VA/Sub-account, with its own term, interest policy, and handling conditions.</p>
            </div>

            <!-- 2.6 Multi-Currency -->
            <div class="logic-card border-l-orange-500">
                <h4><i data-lucide="globe" class="w-5 h-5 text-orange-600 mt-1"></i> 2.6 Multi-Currency Service</h4>
                <p class="text-xs text-gray-600">For products requiring multi-currency support. Manages account-sets, FX rules, and currency mapping.</p>
            </div>
            
            <!-- 2.7 Rule Other -->
            <div class="logic-card border-l-slate-500">
                <h4><i data-lucide="settings" class="w-5 h-5 text-slate-600 mt-1"></i> 2.7 Rule Other Service</h4>
                <p class="text-xs text-gray-600">Stores common business rules like: calendars, interest calculation date rules, fee policies, product code mapping. Called by other services during processing.</p>
            </div>

            <!-- 2.8 Report Service -->
            <div class="logic-card border-l-slate-500">
                <h4><i data-lucide="file-text" class="w-5 h-5 text-slate-600 mt-1"></i> 2.8 Report Service</h4>
                <p class="text-xs text-gray-600">Aggregates DCH operational data and provides to ETL/MIS: Shadow ledger reports, VA/Deposit balance reports, Receipt/Payment reports, Interest allocation, Operational dashboards.</p>
            </div>

            <!-- 2.9 History Service -->
            <div class="logic-card border-l-slate-500">
                <h4><i data-lucide="history" class="w-5 h-5 text-slate-600 mt-1"></i> 2.9 History Service</h4>
                <p class="text-xs text-gray-600">Records full history of configuration changes in DCH: VA/DDA registry, rule changes, limit changes, user action audit. Ensures transparency.</p>
            </div>
        </div>
    </section>

    <!-- 3. ROUTING SERVICE -->
    <section id="sec-3">
        <h2 class="section-title">
            <i data-lucide="route" class="text-blue-600"></i>
            3. Routing Service (Central Orchestration between Gateway and Domain Services)
        </h2>
        <div class="card border-l-4 border-blue-600">
            <p class="font-bold text-gray-800 mb-2">Routes requests from API Gateway to the correct domain service:</p>
            <ul class="text-sm text-gray-700 list-disc ml-5 space-y-2">
                <li><strong>Routing by Transaction Type:</strong> → Sub-account, Balance, Transaction, Top-up, Multi-currency…</li>
                <li><strong>Data Enrichment:</strong> Standardize parameters to ensure compatibility with Core.</li>
                <li><strong>Core Connection:</strong> Acts as a bridge to Core Internal Service (TSSP, MRPC, Dynamic SQL) to call accounting commands or query data from Core Profile.</li>
            </ul>
            <div class="mt-3 bg-blue-50 text-blue-900 text-sm p-2 rounded font-semibold text-center">
                Philosophy: "Routing Service helps Deposit Core Hub implement the philosophy of not modifying Core, while still utilizing full Core capabilities"
            </div>
        </div>
    </section>

    <!-- 4. DATABASE & INFRA -->
    <section id="sec-4">
        <h2 class="section-title">
            <i data-lucide="database" class="text-blue-600"></i>
            4. Database – Core Internal – MQ – ETL – MIS
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="card bg-gray-50 p-4">
                <strong class="block text-gray-800 mb-1">DB Deposit Core Hub</strong>
                <p class="text-xs text-gray-600">Stores entire registry, VA ledger, rules, balance snapshots, product configuration.</p>
            </div>
            <div class="card bg-gray-50 p-4">
                <strong class="block text-gray-800 mb-1">Redis Cache</strong>
                <p class="text-xs text-gray-600">Accelerates VA, balance, and rule lookups.</p>
            </div>
            <div class="card bg-gray-50 p-4">
                <strong class="block text-gray-800 mb-1">Core Profile</strong>
                <p class="text-xs text-gray-600">Account Engine: where real DDA transactions are posted.</p>
            </div>
            <div class="card bg-gray-50 p-4">
                <strong class="block text-gray-800 mb-1">Core MQ</strong>
                <p class="text-xs text-gray-600">Generates events (credit/debit) for Deposit Core Hub and ETL processing.</p>
            </div>
            <div class="card bg-gray-50 p-4 md:col-span-2 lg:col-span-1">
                <strong class="block text-gray-800 mb-1">S3 – ETL – MIS</strong>
                <p class="text-xs text-gray-600">File storage, batch processing, management reporting.</p>
            </div>
        </div>
    </section>

    <!-- 5. VALUE -->
    <section id="sec-5" class="mt-8 mb-12">
        <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-lg p-6 shadow-sm">
            <h2 class="text-xl font-bold text-emerald-800 mb-4 flex items-center gap-2">
                <i data-lucide="thumbs-up" class="w-6 h-6"></i> 5. Overall Architectural Value
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex gap-3 items-start">
                    <div class="bg-white p-1 rounded shadow-sm text-emerald-600"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <p class="text-sm text-gray-700"><strong>Accelerate Time-to-market:</strong> Develop new products without affecting the original Core module.</p>
                </div>
                <div class="flex gap-3 items-start">
                    <div class="bg-white p-1 rounded shadow-sm text-emerald-600"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <p class="text-sm text-gray-700"><strong>Reduce Risk:</strong> Thanks to Shadow Posting, Validation, Reconciliation, Idempotency mechanisms.</p>
                </div>
                <div class="flex gap-3 items-start">
                    <div class="bg-white p-1 rounded shadow-sm text-emerald-600"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <p class="text-sm text-gray-700"><strong>Easy Expansion:</strong> Accumulation Deposit, Multi-currency, Smart Deposit, People-based Deposit…</p>
                </div>
                <div class="flex gap-3 items-start">
                    <div class="bg-white p-1 rounded shadow-sm text-emerald-600"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <p class="text-sm text-gray-700"><strong>Flexible Transaction Flow:</strong> Handles both VA-first and DDA-first flows, serving channels that do not support VA input.</p>
                </div>
                <div class="flex gap-3 items-start md:col-span-2">
                    <div class="bg-white p-1 rounded shadow-sm text-emerald-600"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <p class="text-sm text-gray-700"><strong>Modernization:</strong> Event-driven integration helps achieve real-time capabilities and easy expansion to Data Platform. Standardized Data & API.</p>
                </div>
            </div>
        </div>
    </section>

        <!-- Diagram 2 -->
        <div id="diag-2" class="section-header">2. Diagram #2 – Logical Architecture (Deposit Core Hub + VA)</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/02_Logical_Architecture_DepositCoreHub_VA.png" alt="Logical Architecture">
            <div class="image-caption">Diagram 2/12: Logical Architecture (Deposit Core Hub + VA) (Click to zoom)</div>
        </div>
        <div class="mt-6 space-y-6">
            <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500 text-gray-700">
                <p>The diagram describes the logical architecture of the <span class="font-bold text-indigo-700">Deposit Core Hub</span> layer – a "super business layer" built around the Deposit Module of Core Banking, allowing BIDV to rapidly develop modern collection/payment products, especially <span class="font-bold">Virtual Account (VA)</span>, without modifying the Core.</p>
            </div>
            
            <h3 class="font-bold text-xl text-gray-800 border-b border-gray-200 pb-2">Main Competency Blocks</h3>
            
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-3"><div class="bg-purple-100 p-2 rounded-full text-purple-600"><i data-lucide="route" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-purple-900">Routing Hub – Navigation & Control Brain</h4></div>
                <p class="text-gray-600 mb-3 italic">Acts as the mandatory intermediary point for all collection/payment transactions using VA.</p>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Check transaction type: <span class="font-medium">VA-first</span> or <span class="font-medium">DDA-first</span>.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Call VA Engine to validate VA number before sending accounting to Core.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Identify the corresponding real DDA account (Mapped DDA).</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Receive events from Core to forward to VA Engine for virtual ledger updates.</span></li>
                </ul>
                <div class="mt-3 text-sm font-medium text-purple-800 bg-purple-50 p-2 rounded border border-purple-100">→ Helps separate extended business logic from Core, while ensuring a unified processing flow for all transaction channels.</div>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-4"><div class="bg-blue-100 p-2 rounded-full text-blue-600"><i data-lucide="cpu" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-blue-900">Virtual Account Engine – The Business Heart</h4></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Incoming Service</div><p class="text-xs text-gray-600">Receives incoming transactions, validates VA, finds Mapped DDA, returns result to Routing Hub.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Outgoing Service</div><p class="text-xs text-gray-600">Processes spending orders, checks real/roll-up balance, records shadow debit, and calls Core to debit real DDA.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">Shadow Posting Engine</div><p class="text-xs text-gray-600">Creates virtual entries; updates VA balance and roll-up balance across multi-level VA tree (3–5 levels).</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Balance Engine</div><p class="text-xs text-gray-600">Calculates instantaneous balance, synchronizes with Virtual Ledger and Core events.</p></div>
                </div>
                <p class="mt-4 text-sm text-blue-800 font-medium px-2">→ VA Engine operates independently of Core, helping BIDV flexibly expand features without affecting the core system.</p>
            </div>
			

<!-- START: Key Capabilities Content (English Version) -->
            <div class="space-y-6 mt-12 pt-6 border-t-4 border-dashed border-gray-300">
                <div class="border-b-2 border-gray-200 pb-2 mb-4">
                    <span class="bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded">ENGLISH VERSION</span>
                </div>

                <!-- 1. DDA Handler -->
                <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="bg-indigo-100 p-2 rounded-full text-indigo-600">
                            <i data-lucide="git-branch" class="w-6 h-6"></i>
                        </div>
                        <h4 class="text-lg font-bold text-indigo-900">DDA Handler – DDA-first Business Role</h4>
                    </div>
                    <p class="text-gray-600 mb-3 italic">DDA Handler executes business logic, not orchestration. It is triggered only in 2 specific cases:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Case 1 -->
                        <div class="bg-indigo-50 p-4 rounded border border-indigo-100">
                            <div class="font-bold text-indigo-800 text-sm mb-2 border-b border-indigo-200 pb-1">*) Transaction via DDA (DDA-first)</div>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Check if DDA has registered Virtual Accounts.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Apply rules based on remark/identifier to find the matching VA.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Identify the exact VA for shadow posting & send request to VA Engine.</span>
                                </li>
                            </ul>
                        </div>
                        <!-- Case 2 -->
                        <div class="bg-indigo-50 p-4 rounded border border-indigo-100">
                            <div class="font-bold text-indigo-800 text-sm mb-2 border-b border-indigo-200 pb-1">*) Post-processing</div>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Receive <strong>Credit Notification Event</strong> from Routing Hub after Core accounting.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Resolve VA based on DDA + remark + registry.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-indigo-500 mt-0.5 shrink-0"></i>
                                    <span>Call VA Engine to create shadow posting.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 2. VA Registry -->
                <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="bg-cyan-100 p-2 rounded-full text-cyan-600">
                            <i data-lucide="book-open" class="w-6 h-6"></i>
                        </div>
                        <h4 class="text-lg font-bold text-cyan-900">VA Registry – Central Data Repository</h4>
                    </div>
                    <p class="text-gray-600 mb-3">Acts as the "Configuration Ledger" and "VA Product Portfolio Management System". Stores all lookup, mapping, and status information.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm text-gray-700">
                        <!-- Col 1 -->
                        <div>
                            <h5 class="font-bold text-cyan-800 mb-2">Management & Mapping</h5>
                            <ul class="list-disc ml-4 space-y-1 text-gray-600">
                                <li><strong>Structure Management:</strong> Create VA, Lock/Unlock, Hierarchy (2-4 levels), Assign metadata.</li>
                                <li><strong>VA ↔ DDA Mapping:</strong> Each VA mapped to 01 real DDA, storing effective date and status.</li>
                                <li><strong>Reporting Data Provider:</strong> VA Tree structure, Owner information.</li>
                            </ul>
                        </div>
                        <!-- Col 2 -->
                        <div>
                            <h5 class="font-bold text-cyan-800 mb-2">Validate & Resolve Functions</h5>
                            <ul class="list-disc ml-4 space-y-1 text-gray-600">
                                <li><strong>Validate VA:</strong> Exists? Customer owner? Active? Type (Collections/Payments)?</li>
                                <li><strong>Resolve VA (DDA-first):</strong> Check if DDA has VA, apply remark rules to resolve VA for DDA Handler.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 3. Interest Allocation Engine -->
                <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="bg-amber-100 p-2 rounded-full text-amber-600">
                            <i data-lucide="pie-chart" class="w-6 h-6"></i>
                        </div>
                        <h4 class="text-lg font-bold text-amber-900">Interest Allocation Engine</h4>
                    </div>
                    <p class="text-gray-600 mb-3 italic">A subsystem that performs interest allocation from the real DDA to individual VAs. Enables businesses to track which VA generates cash flow or costs.</p>
                    
                    <div class="bg-amber-50 rounded p-4 border border-amber-100">
                        <div class="font-bold text-amber-800 mb-2 border-b border-amber-200 pb-1">Main Processing Workflow</div>
                        <ul class="space-y-2 text-sm text-gray-700 mt-2">
                            <li class="flex gap-2">
                                <span class="bg-amber-200 text-amber-800 text-xs font-bold px-2 py-0.5 rounded h-fit">Step 1</span> 
                                <span><strong>Receive Interest from Core:</strong> Receive <code>InterestPosted(DDA, amount)</code> event from Routing Hub.</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-amber-200 text-amber-800 text-xs font-bold px-2 py-0.5 rounded h-fit">Step 2</span> 
                                <span><strong>Fetch Data:</strong> Query VA structure from Registry (levels 1-4) and balance/transaction basis (EOD, ADB, Volume...).</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-amber-200 text-amber-800 text-xs font-bold px-2 py-0.5 rounded h-fit">Step 3</span> 
                                <span><strong>Calculation & Shadow Posting:</strong> Apply formula (e.g., pro-rata), write shadow posting to VA Ledger, update VA balance (if interest compounding enabled), and roll-up.</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-amber-200 text-amber-800 text-xs font-bold px-2 py-0.5 rounded h-fit">Audit</span> 
                                <span>Generate allocation statement, log all input-output and rule history.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
<!-- END: Key Capabilities Content (English Version) -->
			
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-slate-800 font-bold"><i data-lucide="server" class="w-5 h-5"></i> Core Banking Layer</div>
                    <p class="text-xs text-slate-500 mb-2 uppercase font-bold tracking-wide border-b border-slate-200 pb-1">Where real entries are recorded</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Deposit Module:</strong> real accounting on DDA account.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Event Bus:</strong> emits “Credit/Debit Notification” signal whenever Core completes a transaction.</span></li>
                    </ul>
                    <div class="text-xs italic text-slate-600 bg-white p-2 rounded border border-slate-100">Core only performs accounting tasks; all coordination logic, mapping, reconciliation, and virtual processing reside in Deposit Core Hub.</div>
                </div>
                <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-cyan-800 font-bold"><i data-lucide="database" class="w-5 h-5"></i> Data Layer</div>
                    <p class="text-xs text-cyan-600 mb-2 uppercase font-bold tracking-wide border-b border-cyan-200 pb-1">Separating real and virtual ledgers</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>Core Ledger:</strong> real DDA balance and transactions.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>VA Ledger (Shadow):</strong> virtual entries for each VA and each level in the system.</span></li>
                    </ul>
                    <div class="text-xs italic text-cyan-700 bg-white p-2 rounded border border-cyan-100">This separation allows VA to expand flexibly without creating risks for Core Banking.</div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-5 shadow-sm">
                <h4 class="text-green-800 font-bold text-lg mb-3 flex items-center gap-2"><i data-lucide="gem" class="w-5 h-5"></i> Architectural Value Summary</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Separate business from Core, reducing load and changes for the core system.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Support two transaction models: VA-first and DDA-first.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Ensure real-time, transparent, and controllable operation.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Platform for many new products: collection/payment on behalf, pooling, cash flow management.</span></div>
                </div>
                <div class="mt-4 pt-3 border-t border-green-200 text-center text-green-900 font-bold italic text-sm">"This is a breakthrough architecture, helping BIDV modernize the deposit module and be ready for the digital transaction banking strategy."</div>
            </div>
        </div>

        <!-- Diagram 10 -->
        <div id="diag-10" class="section-header">3. Diagram #10 – Data Model VA (ERD)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/10_Data_Model_VA_Conceptual.png" alt="Data Model VA (ERD)"><div class="image-caption">Diagram 10/12: Data Model VA (ERD) & Data Flow (Click to zoom)</div></div>
        <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-teal-50 p-4 rounded-lg text-gray-700 border border-teal-100 shadow-sm italic">
                <p>Diagram #10 presents the logical data model (Entity–Relationship Diagram) designed to fully support the lifecycle of the Virtual Account (VA) product and all modules belonging to Deposit Core Hub. This model serves as the foundation of the VA solution, ensuring scalability, fragmentation, traceability, and reconciliation according to corporate transaction standards.</p>
                <p class="mt-2 text-sm text-teal-800">
                    <strong>ERD (Entity–Relationship Diagram):</strong> A diagram describing data and relationships between tables in the database. Organized into 5 main entity groups reflecting full collection-payment business, allocation, multi-level VA structure, and shadow ledger mechanism.
                </p>
            </div>

            <!-- Entity Groups -->
            <div class="space-y-4">
                <!-- Group 1 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-teal-900 mb-2 flex items-center gap-2">
                        <i data-lucide="network" class="w-5 h-5 text-teal-600"></i> 1. VA Entity & Hierarchy Group
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">VirtualAccount</span>
                            <p class="text-xs text-gray-600">Master record representing each VA (status, description, effective date, VA type, Mapped DDA). Governs all identification and management logic.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">VAHierarchy</span>
                            <p class="text-xs text-gray-600">Manages multi-level tree structure (root, parent, child). Serves roll-up balance feature and reporting by corporate structure.</p>
                        </div>
                    </div>
                </div>

                <!-- Group 2 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-teal-900 mb-2 flex items-center gap-2">
                        <i data-lucide="link" class="w-5 h-5 text-teal-600"></i> 2. Mapping & Identifier Entity Group
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">VAIdentifier</span>
                            <p class="text-xs text-gray-600">Contains identifiers (project code, contract, household ID...) used for DDA-first/remark routing. Supports auto-reconciliation.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">DDAEnrollment</span>
                            <p class="text-xs text-gray-600">Links DDA ↔ list of VAs belonging to DDA. Basis for DDA-first flow and interest allocation.</p>
                        </div>
                    </div>
                </div>

                <!-- Group 3 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-teal-900 mb-2 flex items-center gap-2">
                        <i data-lucide="book" class="w-5 h-5 text-teal-600"></i> 3. Ledger & Posting Entity Group
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">VALedger</span>
                            <p class="text-xs text-gray-600">Records shadow posting (Incoming, Outgoing, Interest, Adjustment). Each record contains: coreTxnId, VAId, amount, status, timestamp.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">VABalance</span>
                            <p class="text-xs text-gray-600">Stores current balance (Available, Pending, Roll-up). Automatically updated after each posting.</p>
                        </div>
                    </div>
                </div>

                <!-- Group 4 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-teal-900 mb-2 flex items-center gap-2">
                        <i data-lucide="percent" class="w-5 h-5 text-teal-600"></i> 4. Interest Allocation Entity Group
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">InterestAllocationRule</span>
                            <p class="text-xs text-gray-600">Configures allocation method (Pro-rata, Fixed ratio, Weighted, Average Balance...).</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">InterestAllocationDetail</span>
                            <p class="text-xs text-gray-600">Stores interest allocation results per period for each VA, serving statements and internal checks.</p>
                        </div>
                    </div>
                </div>

                <!-- Group 5 -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-teal-900 mb-2 flex items-center gap-2">
                        <i data-lucide="external-link" class="w-5 h-5 text-teal-600"></i> 5. Outgoing Entity Group
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">OutgoingRequest</span>
                            <p class="text-xs text-gray-600">Manages outgoing requests from VA: amount, beneficiary, status. Starting point of Outgoing Sequence.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-800 block mb-1">OutgoingSettlement</span>
                            <p class="text-xs text-gray-600">Records actual result from Core after DDA debit. Reconciles with shadow debit.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary & Value Block -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
                    <h4 class="font-bold text-gray-800 mb-2 text-sm uppercase">Summary of Design Features</h4>
                    <ul class="text-xs text-gray-600 list-disc ml-4 space-y-1">
                        <li>Completely separate real (Core) and virtual (VA) ledgers.</li>
                        <li>Support multi-level VA structure & event-driven.</li>
                        <li>Immutable ledger format, ensuring auditability.</li>
                        <li>Open structure, easy to add new modules (fees, limits).</li>
                    </ul>
                </div>
                <div class="bg-gradient-to-r from-teal-50 to-green-50 border border-teal-200 p-4 rounded-lg">
                    <h4 class="font-bold text-teal-800 mb-2 text-sm uppercase">Architectural Value of ERD</h4>
                    <ul class="text-xs text-teal-700 list-disc ml-4 space-y-1">
                        <li>Optimal scalability (hundreds of thousands of VAs/customer).</li>
                        <li>Easy microservice splitting/sharding.</li>
                        <li>Foundation for real-time reporting & dashboards.</li>
                        <li>Ensure data integrity for Audit/SBV/Big4.</li>
                    </ul>
                </div>
            </div>
            <p class="text-center text-xs text-gray-500 italic mt-2">"The VA ERD is the core blueprint, serving as the foundation for the entire Deposit Core Hub architecture and BIDV's Virtual Account system."</p>
        </div>

        <!-- Diagram 11 -->
        <div id="diag-11" class="section-header">4. Diagram #11 – Deployment Architecture</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/11_Logical_ERD_VA_Detail.png" alt="Logical ERD Detail"><div class="image-caption">Diagram 11/12: Deployment Architecture (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Modern Deployment Model (Deployment & Integration)</p>
            <p>Deposit Core Hub (Super Layer) is deployed on a modern platform, separated from the traditional Core Banking environment. This diagram describes in detail how the system is deployed and operated.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Containerized:</span> Using Docker/Kubernetes for VA Engine & Routing Hub.</li>
                <li><span class="font-bold">Independent Scaling:</span> Ability to scale independently per microservice (Incoming Flow, Outgoing Flow, Lookup Services...).</li>
                <li><span class="font-bold">Zero-downtime deployment:</span> Applying Rolling Update or Blue/Green methods.</li>
                <li><span class="font-bold">HA & DR:</span> Deployed in Multinode Cluster model (High Availability) and synchronized with DR Site (Disaster Recovery).</li>
            </ul>
        </div>

        <!-- Diagram 12 -->
        <div id="diag-12" class="section-header">5. Diagram #12 – Integration & Deployment Architecture (Integration Mechanism)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/12_Integration_Deployment_VA_DepositCoreHub.png" alt="Integration & Deployment"><div class="image-caption">Diagram 12/12: Integration Architecture (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Asynchronous Integration Mechanism (Event-Driven)</p>
            <p>Event-Driven integration architecture (based on Event Bus like Kafka) is key to achieving performance and stability, reducing synchronous dependency between the two systems, Core and Super Layer.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Core to Super Layer:</span> Core Banking emits events (posting, interest) to Event Bus after completing real ledger accounting (DDA).</li>
                <li><span class="font-bold">Super Layer Listener:</span> VA Engine listens for events. Only upon receiving confirmation event of successful Credit/Debit from Core, does VA Engine proceed to Credit/Debit the <span class="text-indigo-700 font-semibold">VA Ledger (virtual ledger)</span>.</li>
                <li><span class="font-bold">Guarantee:</span> <span class="font-semibold text-red-700">at-least-once delivery</span> mechanism and retry to maintain transaction integrity.</li>
            </ul>
        </div>

        <h2 id="group-2" class="sub-header"><i data-lucide="trello" class="w-6 h-6 text-indigo-500"></i> II. Group 2 – Logical Architecture & Business Process Flow Diagrams</h2>
        <p class="pl-2 text-gray-700 italic">These diagrams describe each business flow in detail, including transaction flows, VA management, and reconciliation (Diagrams #3 $\to$ #9).</p>

        <!-- Diagram 3 -->
        <div id="diag-3" class="section-header">6. Diagram #3 – Flow #1: VA-first Incoming (Deposit into VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/03_Flow_VA_First_Incoming.png" alt="VA-first Incoming Flow"><div class="image-caption">Diagram 3/12: VA-first Incoming Flow (Deposit into VA) (Click to zoom)</div></div>
        <div class="mt-6 space-y-6">
            <div class="bg-blue-50 p-4 rounded-lg text-gray-700 border border-blue-100 shadow-sm italic">
                <p>This diagram describes the processing flow when a customer actively enters a <span class="font-semibold text-blue-700">Virtual Account (VA)</span> number on transaction channels (Internet Banking, H2H, API, counter…). This is the international standard model (“VA-first”), ensuring transactions are checked for validity right from the start, helping reduce errors and reconciliation costs.</p>
            </div>
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Channel sends request by VA number</h4><p class="text-sm text-gray-600 mb-2">Customer enters VA number directly instead of real DDA number.</p><ul class="text-xs text-gray-500 list-disc ml-4"><li>Info: VA Number, Amount, Sender/Receiver, Reference, Collection service...</li><li class="italic text-blue-600 mt-1">→ Channel does not process, forwards entire request to Routing Hub.</li></ul></div>
                </div>
                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub sends validation request to VA Engine</h4><p class="text-sm text-gray-600 mb-2">Routing Hub acts as business "checkpoint":</p><ul class="text-xs text-gray-500 list-disc ml-4 space-y-1"><li>Call Validate VA service at VA Engine.</li><li>Check: Existence, Status (Active/Locked), Constraints (Collect/Spend/Limit).</li><li>Identify <span class="font-semibold text-gray-700">Mapped DDA</span> – real account attached to VA.</li></ul><div class="flex gap-2 mt-2 text-xs font-semibold"><span class="text-red-600 bg-red-50 px-2 py-1 rounded">Invalid → Return error immediately</span><span class="text-green-600 bg-green-50 px-2 py-1 rounded">Valid → Get DDA & continue</span></div></div>
                </div>
                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub posts Credit to DDA via Core Banking</h4><p class="text-sm text-gray-600">Routing Hub uses Mapped DDA to call Core:</p><ul class="text-xs text-gray-500 list-disc ml-4 mt-1"><li>Perform Credit to DDA (real accounting).</li><li>Save entry at Core.</li><li>Check limit, real account status.</li></ul></div>
                </div>
                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Core Banking emits Credit Notification Event</h4><p class="text-sm text-gray-600">After successful accounting, Core emits event to Event Bus:</p><div class="mt-2 text-xs bg-gray-50 p-2 rounded border text-gray-600 font-mono">{ Transaction Type, New Balance, Amount, Txn ID, DDA }</div><p class="text-xs text-gray-500 mt-1 italic">→ Event is forwarded to Routing Hub for further VA processing.</p></div>
                </div>
                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub sends Post-Notification to VA Engine</h4><p class="text-sm text-gray-600">Confirms Core entry success & sends info for VA to write ledger.</p><p class="text-xs text-indigo-600 font-semibold mt-1 bg-indigo-50 inline-block px-2 py-1 rounded">Guarantee: No pre-write - No double write - Write only when Core succeeds.</p></div>
                </div>
                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">VA Engine writes Shadow Posting & updates balance</h4><div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2"><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>1. Create Shadow Posting (Credit)</strong><br>Save to VA Ledger.</div><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>2. Update Balance</strong><br>VA receives money & Roll-up parent balance.</div></div><p class="text-xs text-gray-500 mt-2 italic">Idempotency mechanism ensures each Core transaction corresponds to exactly 1 shadow posting.</p></div>
                </div>
                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1"><h4 class="font-bold text-green-900 mb-1">Transaction flow complete</h4><ul class="text-sm text-green-800 list-disc ml-4"><li>Core Ledger & VA Virtual Ledger are updated.</li><li>VA balances at all levels synchronized near real-time.</li><li>Transaction displayed correctly for customer at corresponding VA level.</li></ul></div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-emerald-50 to-green-50 border-l-4 border-emerald-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-emerald-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="award" class="w-6 h-6"></i> Value of VA-first flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>No “lost VA” transactions:</strong> VA is checked before entering Core.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Fast reconciliation speed:</strong> VA knows exactly who transaction belongs to.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Save operational costs:</strong> Reduce manual investigation.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Flexible expansion:</strong> Does not require logic modification at Core.</span></div>
                </div>
                <p class="mt-3 text-emerald-900 font-semibold italic text-sm text-center border-t border-emerald-200 pt-2">"This flow is the main pillar in Deposit Core Hub design and BIDV's Virtual Account solution"</p>
            </div>
        </div>

        <!-- Diagram 4 -->
        <div id="diag-4" class="section-header">7. Diagram #4 – DDA-first Incoming Flow (Credit to VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/04_Flow_DDA_First_Incoming.png" alt="DDA-first Incoming Flow"><div class="image-caption">Diagram 4/12: DDA-first Incoming Flow (Credit to VA) (Click to zoom)</div></div>
        
        <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-blue-50 p-4 rounded-lg text-gray-700 border border-blue-100 shadow-sm italic">
                <p>This diagram describes the processing model when the customer does not enter a Virtual Account (VA), but only enters BIDV's real DDA account number (via interbank transfer, counter, POS, or channels not supporting VA). This is a common model in the Vietnamese banking system, where VA is not yet supported cross-channel or cross-bank.</p>
                <p class="mt-2 font-semibold text-blue-800">The DDA-first flow helps BIDV still apply Virtual Account for customers registered for VA service, even when the transaction does not have a VA number at the input.</p>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Channel sends transaction by DDA number</h4>
                        <p class="text-sm text-gray-600 mb-2">Incoming transaction usually has structure:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4">
                            <li>Customer's DDA number at BIDV</li>
                            <li>Amount</li>
                            <li>Sender info</li>
                            <li>Reference/remark</li>
                            <li><strong>No VA number because sending system doesn't support it</strong></li>
                        </ul>
                        <p class="text-xs italic text-blue-600 mt-2">Channel sends directly DDA → Routing Hub of Deposit Core Hub.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls Core Banking to credit DDA</h4>
                        <p class="text-sm text-gray-600 mb-1">Following standard banking processing, Routing Hub:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Receives request</li>
                            <li>Does not attempt to find VA at first step (since transaction may not relate to VA)</li>
                            <li>Calls Core Banking to perform real Credit DDA</li>
                        </ul>
                        <div class="mt-2 text-xs bg-gray-50 p-2 rounded border text-gray-600">
                            <strong>Core Banking accounting:</strong> Saves entry, checks limit/status, updates DDA balance. <br/>
                            When successful: Core emits <strong>Credit Notification Event</strong> to Event Bus.
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Deposit Event Bus signals successful transaction</h4>
                        <p class="text-sm text-gray-600 mb-1">Event contains:</p>
                        <div class="flex flex-wrap gap-2 text-xs text-gray-500 font-mono mt-1">
                            <span class="bg-gray-100 px-2 py-1 rounded">DDA Number</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Amount</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Core Txn ID</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Remark</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Timestamp</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Sender/Channel Source</span>
                        </div>
                        <p class="text-xs italic text-gray-500 mt-2">Routing Hub receives event to proceed to VA analysis step.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub checks if this DDA is registered for Virtual Account</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub queries VA Enrollment Registry:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Is this DDA attached to one or more VAs?</li>
                            <li>If yes, are VAs active?</li>
                            <li>Is there a rule to allocate VA by remark/reference?</li>
                            <li>Need to match by contract code/household/project/PO?</li>
                        </ul>
                        <div class="flex flex-col gap-1 mt-2 text-xs font-semibold">
                            <span class="text-gray-500 bg-gray-100 px-2 py-1 rounded border">If DDA has no VA service → End flow / Transaction only credits DDA.</span>
                            <span class="text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-100">If DDA has VA service → Continue to transfer to VA Engine to create shadow posting.</span>
                        </div>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls VA Engine to identify VA receiving transaction</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2">
                            <div class="text-xs text-gray-600">
                                <strong>Send enriched event to VA Engine:</strong>
                                <ul class="list-disc ml-4 mt-1">
                                    <li>Core Transaction ID</li>
                                    <li>Credited DDA Number</li>
                                    <li>Amount</li>
                                    <li>Remark/Reference</li>
                                    <li>Value Date</li>
                                </ul>
                            </div>
                            <div class="text-xs text-blue-800 bg-blue-50 p-2 rounded border border-blue-100">
                                <strong>VA Engine will:</strong>
                                <ul class="list-disc ml-4 mt-1">
                                    <li>Find suitable VA by rule (if remark contains identifier)</li>
                                    <li>Or assign default to a master VA (parent VA) if unclear</li>
                                    <li>Check VA status</li>
                                    <li>Prepare to write shadow posting</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">VA Engine writes Shadow Posting and updates VA balance</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                             <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>1. Check Idempotency</strong><br>Avoid duplicate transactions.</div>
                             <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>2. Write virtual CREDIT entry</strong><br>For corresponding VA.</div>
                             <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>3. Update balance</strong><br>End-level VA balance & Roll-up parent balance.</div>
                        </div>
                        <p class="text-xs text-indigo-700 mt-2 font-medium italic">Diagram fully shows: Core accounts first – VA processes later, helping BIDV fit channels not supporting VA but still maintaining cash flow control by VA.</p>
                    </div>
                </div>

                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">DDA-first flow complete</h4>
                        <ul class="text-sm text-green-800 list-disc ml-4 space-y-1">
                            <li>Core has accounted real transaction.</li>
                            <li>VA Ledger has shadow posting for correct VA.</li>
                            <li>VA balance and parent levels updated fully.</li>
                            <li>Corporates can reconcile by VA, even if original transaction didn't enter VA number.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border-l-4 border-indigo-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-indigo-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="star" class="w-6 h-6"></i> Value of DDA-first flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Wide coverage capability:</strong> Suitable for all payment channels in Vietnam.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>No need to modify external systems:</strong> Compatible with NapAS, other banks, e-wallets.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Full experience:</strong> VA customers do not miss transactions.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Reduce reconciliation errors:</strong> Especially effective with remark-based routing.</span></div>
                </div>
                <p class="mt-3 text-indigo-900 font-semibold italic text-sm text-center border-t border-indigo-200 pt-2">"This flow is an important supplement to VA-first, ensuring Virtual Account can operate effectively in a multi-channel, non-uniform environment like Vietnam."</p>
            </div>
        </div>

        <!-- Diagram 5 -->
        <div id="diag-5" class="section-header">8. Diagram #5 – Outgoing from VA (Debit from VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/05_Flow_Outgoing_From_VA.png" alt="Outgoing from VA"><div class="image-caption">Diagram 5/12: Outgoing Transaction Flow (Debit from VA) (Click to zoom)</div></div>
        
        <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-red-50 p-4 rounded-lg text-gray-700 border border-red-100 shadow-sm italic">
                <p>The diagram describes the processing procedure when a customer requests to transfer money from a Virtual Account (VA) to another DDA account within BIDV or an account at another bank. This is a critical business flow for VA to become a “spendable account”, serving POBO (Payment On Behalf Of) models, project payments, budget payments, or corporate cash flow management.</p>
                <p class="mt-2 font-semibold text-red-800">The Outgoing VA flow is designed with the principle: VA controls balance – Core Banking performs real entry.</p>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Transaction channel sends debit order from VA</h4>
                        <p class="text-sm text-gray-600 mb-2">Customer or corporate system (H2H/API) creates order:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4">
                            <li>Source Virtual Account</li>
                            <li>Transfer Amount</li>
                            <li>Beneficiary, Beneficiary Bank</li>
                            <li>Transaction Description (remark)</li>
                            <li>Business Context (POBO, payroll, project payment…)</li>
                        </ul>
                        <p class="text-xs italic text-red-600 mt-2">Channel transfers request to Routing Hub for processing.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls VA Engine to check rights & balance</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub calls VA Outgoing Service to:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Check VA existence and activity</li>
                            <li>Check business rules: Is VA allowed to spend?</li>
                            <li>Identify VA level in VA tree</li>
                            <li>Query VA balance (real balance or roll-up balance depending on policy)</li>
                            <li>Check transaction limits</li>
                            <li>Identify Mapped DDA – real account representing VA</li>
                        </ul>
                        <div class="flex flex-col gap-1 mt-2 text-xs font-semibold">
                            <span class="text-red-600 bg-red-50 px-2 py-1 rounded border border-red-100">If ineligible → Return error to channel, do not call Core.</span>
                            <span class="text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100">If valid → VA Engine allows proceeding to next step.</span>
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">VA Engine writes Shadow Debit first (reserve balance)</h4>
                        <p class="text-sm text-gray-600 mb-2">To avoid “double spending”, VA Engine:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Writes temporary Shadow Posting DEBIT</li>
                            <li>Reduces VA balance immediately</li>
                            <li>Updates roll-up balance on VA tree</li>
                            <li>Creates transaction reference to link with real DDA transaction</li>
                        </ul>
                        <p class="text-xs italic text-gray-500 mt-2 font-medium">Shadow posting at this step ensures VA accurately reflects spending capability, even if Core processes late or asynchronously.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub sends debit request to Core Banking</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2">
                            <div class="text-xs text-gray-600">
                                <strong>Routing Hub (using Mapped DDA):</strong>
                                <ul class="list-disc ml-4 mt-1">
                                    <li>Sends DEBIT DDA request (real accounting)</li>
                                    <li>Includes beneficiary info, remark, transaction type</li>
                                </ul>
                            </div>
                            <div class="text-xs text-gray-600">
                                <strong>Core executes:</strong>
                                <ul class="list-disc ml-4 mt-1">
                                    <li>Checks DDA balance</li>
                                    <li>Checks account limits, AML risks</li>
                                    <li>Records DEBIT and creates outgoing transaction</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-2 text-xs bg-red-50 p-2 rounded border border-red-100 text-red-800">
                            <strong>If Core rejects (insufficient funds, account closed…):</strong> Routing Hub returns error to channel & VA Engine rolls back shadow posting, restores balance.
                        </div>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Core emits Debit Notification Event to Event Bus</h4>
                        <p class="text-sm text-gray-600 mb-1">When debit is successful, Core sends:</p>
                        <div class="flex flex-wrap gap-2 text-xs text-gray-500 font-mono mt-1">
                            <span class="bg-gray-100 px-2 py-1 rounded">Debited DDA Number</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Amount</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Core Txn ID</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Outgoing Details</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Success Status</span>
                        </div>
                        <p class="text-xs italic text-gray-500 mt-2">Routing Hub receives event to finalize processing at VA side.</p>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub notifies VA Engine to finalize transaction</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub calls VA Engine – ConfirmOutgoing:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Confirms shadow posting debit from <strong>pending → completed</strong>.</li>
                            <li>Updates transaction status</li>
                            <li>Writes full VA Ledger</li>
                            <li>Finalizes VA balance and roll-up across tree</li>
                        </ul>
                        <p class="text-xs text-indigo-700 mt-2 font-medium italic">If Core sends event late, VA Engine uses idempotency mechanism to ensure no duplicate recording.</p>
                    </div>
                </div>

                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">Transaction flow complete</h4>
                        <ul class="text-sm text-green-800 list-disc ml-4 space-y-1">
                            <li>DDA is truly debited.</li>
                            <li>VA Ledger records shadow debit.</li>
                            <li>VA balance decreases instantly.</li>
                            <li>Balances of parent VAs (roll-up) automatically updated.</li>
                            <li>Channel receives successful transaction info.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-red-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-red-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="star" class="w-6 h-6"></i> Value of Outgoing from VA design</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-red-600 mt-0.5"></i><span><strong>Control balance at VA:</strong> Independent of Core processing time.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-red-600 mt-0.5"></i><span><strong>Full POBO support:</strong> Paying on behalf, decentralized payment by VA.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-red-600 mt-0.5"></i><span><strong>No Core intervention:</strong> Only sends debit DDA request like normal transaction.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-red-600 mt-0.5"></i><span><strong>Safe:</strong> Reduce risk, prevent double-spending.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-red-600 mt-0.5"></i><span><strong>Open structure:</strong> Supports both internal and inter-bank payments.</span></div>
                </div>
                <p class="mt-3 text-red-900 font-semibold italic text-sm text-center border-t border-red-200 pt-2">"Outgoing from VA flow is the condition for BIDV to fully deploy the Virtual Account ecosystem and expand Cash Management products for businesses."</p>
            </div>
        </div>

        <!-- Diagram 6 -->
        <div id="diag-6" class="section-header">9. Diagram #6 – Interest Allocation Flow</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/06_Flow_Interest_Allocation.png" alt="Interest Allocation Flow"><div class="image-caption">Diagram 6/12: Interest Allocation Flow (Click to zoom)</div></div>
       <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-amber-50 p-4 rounded-lg text-gray-700 border border-amber-100 shadow-sm italic">
                <p>This diagram describes the process of allocating deposit interest from the real DDA account (managed by Core Banking) down to Virtual Accounts (VA) via shadow posting mechanism. This is an important function helping the VA model operate equivalently to sub-ledger accounts, serving:</p>
                <ul class="list-disc ml-5 mt-2 text-sm">
                    <li>Project / contract management</li>
                    <li>Multi-unit / multi-company cash flow management</li>
                    <li>Collection/payment on behalf with reimbursable nature</li>
                    <li>Advanced corporate financial services</li>
                </ul>
                <p class="mt-2 font-semibold text-amber-800 text-sm">VA Interest Allocation is an internal posting flow, creating no real transaction at Core, but ensuring each VA receives benefits according to its balance or registered allocation rules.</p>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-amber-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Core Banking calculates real interest on DDA account</h4>
                        <p class="text-sm text-gray-600 mb-2">At period end (day, month or product cycle), Core Banking:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Calculates interest on DDA according to deposit product</li>
                            <li>Posts interest entry to real DDA & Updates Core Ledger</li>
                            <li>Emits <strong>InterestCreditedEvent</strong> to Deposit Event Bus</li>
                        </ul>
                        <div class="mt-2 text-xs bg-amber-50 p-2 rounded border border-amber-100 text-amber-800">
                            <strong>Event Info:</strong> DDA Number, Real Interest Amount, Calculation Period, Balance used for calculation, Core Txn ID.
                        </div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-amber-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub receives interest event from Core</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub acts as intermediary:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Receives interest event from Event Bus</li>
                            <li>Enriches info (value date, DDA → corresponding VA list)</li>
                            <li>Routes interest event to <strong>Interest Allocation Engine</strong> belonging to Deposit Core Hub</li>
                        </ul>
                        <p class="text-xs italic text-gray-500 mt-2">Routing Hub does not calculate interest, only coordinates the flow.</p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-amber-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Interest Allocation Engine identifies VA list for allocation</h4>
                        <p class="text-sm text-gray-600 mb-1">Engine uses VA Registry & VA Balance Table to:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 mb-2">
                            <li>List all VAs belonging to DDA (levels 1–4) and extract end-of-period balance</li>
                            <li>Exclude locked, closed VAs or those ineligible for interest</li>
                        </ul>
                        <p class="text-sm text-gray-600 mb-1 font-semibold">Determines allocation method by configuration:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-gray-500">
                            <div class="bg-gray-50 p-2 rounded">Pro-rata by end-of-period balance</div>
                            <div class="bg-gray-50 p-2 rounded">Pro-rata by average balance</div>
                            <div class="bg-gray-50 p-2 rounded">Weighted by business rule</div>
                            <div class="bg-gray-50 p-2 rounded">Fixed ratio</div>
                        </div>
                        <p class="text-xs text-indigo-700 mt-2 italic">Result: Engine creates detailed interest allocation table for each VA.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-amber-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Engine creates Shadow Posting interest for each VA</h4>
                        <p class="text-sm text-gray-600 mb-2">Interest Allocation Engine performs:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li><strong>Shadow Posting CREDIT</strong> to each VA's ledger</li>
                            <li>Logs interest: VAId, amount, allocation ratio, interest period reference</li>
                            <li>Updates balance of VA receiving interest and roll-up balances of parent levels</li>
                        </ul>
                        <div class="text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded mt-2 border border-red-100 inline-block">
                            Note: No real entry is added to Core at this step.
                        </div>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-amber-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Update reports & display interest on VA</h4>
                        <p class="text-sm text-gray-600 mb-2">After allocation:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>VA Ledger stores full interest transactions</li>
                            <li>VA Balance Engine updates instantaneous balance</li>
                            <li>Reporting system generates: VA Interest Statement, DDA Interest Allocation Table, Reconciliation Table.</li>
                        </ul>
                        <p class="text-xs italic text-gray-500 mt-1">Interest is displayed to customer immediately after engine completes.</p>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">Interest Allocation flow complete</h4>
                        <ul class="text-sm text-green-800 list-disc ml-4 space-y-1">
                            <li>DDA receives real interest from Core.</li>
                            <li>VAs receive virtual interest according to registered rules.</li>
                            <li>VA balance and roll-up balance are synchronized.</li>
                            <li>Customers have detailed interest reports for each VA.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-orange-400 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-orange-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="pie-chart" class="w-6 h-6"></i> Value of Interest Allocation flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-orange-600 mt-0.5"></i><span><strong>Cash flow transparency:</strong> By virtual sub-account.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-orange-600 mt-0.5"></i><span><strong>Cash Management advantage:</strong> Superior to other banks.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-orange-600 mt-0.5"></i><span><strong>No Core impact:</strong> Does not increase complexity for real accounting.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-orange-600 mt-0.5"></i><span><strong>Meet corporate needs:</strong> Project management, capital cost, holding.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-orange-600 mt-0.5"></i><span><strong>Easy expansion:</strong> Flexible according to market and policy.</span></div>
                </div>
                <p class="mt-3 text-orange-900 font-semibold italic text-sm text-center border-t border-orange-200 pt-2">"Interest allocation logic is an essential component for BIDV's VA ecosystem to approach international standards and meet complex future cases."</p>
            </div>
        </div>

        <!-- Diagram 7 -->
        <div id="diag-7" class="section-header">10. Diagram #10 – Sequence VA-first</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/07_Sequence_VA_First.png" alt="Sequence VA First"><div class="image-caption">Diagram 7/12: Sequence VA-first (Click to zoom)</div></div>
     <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-indigo-50 p-4 rounded-lg text-gray-700 border border-indigo-100 shadow-sm italic">
                <p>This diagram describes the interaction sequence between system components when a customer directly enters a Virtual Account (VA) on a transaction channel. This is the standard business flow, ensuring VA is checked from the start and all collection transactions are accurately recorded in the VA account.</p>
                <div class="mt-2 font-semibold text-indigo-800 text-sm">
                    <span class="uppercase font-bold">Main Goal:</span> Validate VA first – Account DDA later – Write Shadow Posting last, ensuring transactions are not “lost VA”, no balance discrepancy, and avoiding difficult reconciliation errors.
                </div>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Channel sends payment request by VA number</h4>
                        <p class="text-sm text-gray-600 mb-2">Customer (Internet Banking, H2H, Corporate API, counter) sends request including:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>VA Number, Amount</li>
                            <li>Sender</li>
                            <li>Transaction Reference (invoice, contract…)</li>
                        </ul>
                        <p class="text-xs italic text-indigo-600 mt-2">Entire request is transferred to Routing Hub, not processed at channel.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls VA Engine to validate VA (ValidateVA)</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub performs pre-check call:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Does VA exist and is it active (ACTIVE)?</li>
                            <li>Belongs to which DDA? Is it suitable for business?</li>
                        </ul>
                        <div class="flex flex-col gap-1 mt-2 text-xs font-semibold">
                            <span class="text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100">APPROVED + Mapped DDA</span>
                            <span class="text-red-600 bg-red-50 px-2 py-1 rounded border border-red-100">REJECTED (VA_NOT_FOUND, LOCKED...) → Return error to channel.</span>
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-slate-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub sends real accounting request to Core Banking</h4>
                        <p class="text-sm text-gray-600 mb-2">If VA is valid, Routing Hub uses Mapped DDA to:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Send CREDIT request to real account.</li>
                            <li>Call Deposit Module for real accounting.</li>
                            <li>Check limit, real account status.</li>
                        </ul>
                        <p class="text-xs italic text-slate-600 mt-2">If Core rejects → Routing Hub returns error to channel; VA does not write shadow posting.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-slate-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Core Banking emits Credit Notification Event to Event Bus</h4>
                        <p class="text-sm text-gray-600 mb-1">After successful accounting, Core sends event via Deposit Event Bus:</p>
                        <div class="mt-2 text-xs bg-slate-50 p-2 rounded border border-slate-100 text-slate-800 font-mono">
                            { DDA, Amount, Transaction ID, Value Date, Info }
                        </div>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub receives event and forwards to VA Engine</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub acts as “bridge”:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Receives event from Event Bus & Applies routing rules.</li>
                            <li>Sends notification <strong>NotifyCreditPosted</strong> to VA Engine.</li>
                        </ul>
                        <p class="text-xs italic text-purple-600 mt-2">Goal: VA only creates shadow posting when Core has truly recorded.</p>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">VA Engine creates Shadow Posting and updates VA balance</h4>
                        <p class="text-sm text-gray-600 mb-2">Upon receiving notification from Routing Hub, VA Engine:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Checks idempotency (no duplicate recording).</li>
                            <li>Creates Shadow Posting CREDIT.</li>
                            <li>Updates lowest level VA balance & Roll-up balance of parent levels.</li>
                            <li>Saves VA Ledger for statements, reconciliation.</li>
                        </ul>
                        <p class="text-xs font-semibold text-purple-800 mt-2">→ From here, VA accurately reflects corporate cash flow.</p>
                    </div>
                </div>

                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">Flow complete</h4>
                        <p class="text-sm text-green-800 mb-2">Channel receives successful transaction notification. Flow ensures:</p>
                        <ul class="text-xs text-green-700 list-disc ml-4 space-y-1">
                            <li>No transaction recorded to wrong VA.</li>
                            <li>VA balance matches DDA (near real-time).</li>
                            <li>Enterprises have data immediately.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-indigo-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="git-merge" class="w-6 h-6"></i> Value of Sequence VA-first flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Avoid loss:</strong> Reduce mapping errors, reduce manual investigation.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Ensure VA always correct:</strong> Not dependent on remark or heuristics.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>Strong scalability:</strong> Fits international standards (India, Indonesia, Singapore).</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-indigo-600 mt-0.5"></i><span><strong>No Core impact:</strong> Completely separate extended business from core system.</span></div>
                </div>
                <p class="mt-3 text-indigo-900 font-semibold italic text-sm text-center border-t border-indigo-200 pt-2">"This flow is the most important foundation in BIDV's Virtual Account architecture"</p>
            </div>
        </div>

        <!-- Diagram 8 -->
        <div id="diag-8" class="section-header">11. Diagram #8 – Sequence Outgoing VA</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/08_Sequence_Outgoing_VA.png" alt="Sequence Outgoing VA"><div class="image-caption">Sequence Outgoing VA(Click to zoom)</div></div>
        <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-rose-50 p-4 rounded-lg text-gray-700 border border-rose-100 shadow-sm italic">
               <p>The diagram describes the interaction order between system components when a customer requests to spend money from a Virtual Account (VA). This is an important business flow enabling VA not only to receive money but also to perform payments, suitable for corporate cash flow management models such as:</p>
                <ul class="list-disc ml-5 mt-2 text-sm space-y-1">
                    <li>POBO (Payment On Behalf Of)</li>
                    <li>Project-based payments</li>
                    <li>Internal group budget payments</li>
                    <li>Inter-unit fund transfers</li>
                </ul>
                <p class="mt-2 font-semibold text-rose-800 text-sm">
                    <span class="uppercase font-bold">Core Principle:</span> VA controls balance – Core Banking writes real ledger – VA updates virtual ledger.
                </p>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Channel sends transfer request from VA</h4>
                        <p class="text-sm text-gray-600 mb-2">Channel (IB/H2H/Corporate API) sends request including:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Source VA, Beneficiary Account (Internal DDA/Inter-bank)</li>
                            <li>Amount, Transaction Description</li>
                            <li>Transaction Type (Internal/Inter-bank)</li>
                        </ul>
                        <p class="text-xs italic text-rose-600 mt-2">Request is put into Routing Hub for coordination.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls VA Engine to check outgoing conditions</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub calls <strong>VA Outgoing Service</strong> to:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Check VA activity & spending rights (allowed/blocked).</li>
                            <li>Verify VA belongs to which DDA (Mapped DDA).</li>
                            <li>Get VA balance at transaction time & Check limits.</li>
                            <li>Evaluate business rules.</li>
                        </ul>
                        <div class="mt-2 text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded border border-red-100">
                            If VA invalid or insufficient balance → Routing Hub returns error immediately.
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">VA Engine writes Shadow Debit to reserve balance</h4>
                        <p class="text-sm text-gray-600 mb-2">VA performs “temporary deduction” by:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-gray-500 mb-2">
                            <div class="bg-gray-50 p-2 rounded border">Create Shadow Posting DEBIT (pending)</div>
                            <div class="bg-gray-50 p-2 rounded border">Reduce VA balance & roll-up immediately</div>
                        </div>
                        <p class="text-xs italic text-gray-500">→ Helps prevent double spending when multiple payment orders run simultaneously.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub sends Debit DDA request to Core Banking</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub sends request to <strong>Deposit Module</strong>:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Debit real DDA account corresponding to VA.</li>
                            <li>Execute internal or inter-bank payment.</li>
                            <li>Check Core limits, AML/Fraud, account status.</li>
                        </ul>
                        <p class="text-xs font-semibold text-red-700 mt-2">Note: If debit fails → VA Engine must roll-back shadow posting.</p>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Core Banking emits Debit Notification Event</h4>
                        <p class="text-sm text-gray-600 mb-1">If transaction successful, Core emits event to <strong>Deposit Event Bus</strong> containing:</p>
                        <div class="mt-2 flex flex-wrap gap-2 text-xs font-mono text-gray-600">
                            <span class="bg-gray-100 px-2 py-1 rounded">Debited DDA</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Amount</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Core Txn ID</span>
                            <span class="bg-gray-100 px-2 py-1 rounded">Status SUCCESS</span>
                        </div>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-rose-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls VA Engine to finalize transaction</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub receives event and calls <strong>VA Engine – ConfirmOutgoing</strong>:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Transitions shadow posting from <strong>pending → completed</strong>.</li>
                            <li>Updates transaction status</li>
                            <li>Writes VA Ledger fully</li>
                            <li>Finalizes official balance & roll-up</li>
                        </ul>
                        <p class="text-xs italic text-gray-500 mt-2">Idempotency mechanism ensures no duplicate write even if event arrives late.</p>
                    </div>
                </div>

                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">Transaction completed system-wide</h4>
                        <ul class="text-sm text-green-800 list-disc ml-4 space-y-1">
                            <li>DDA has been truly debited.</li>
                            <li>VA has recorded shadow debit and updated balance.</li>
                            <li>Multi-level VA structure updated immediately.</li>
                            <li>Customer sees VA balance updated correctly according to transaction.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-pink-50 to-rose-50 border-l-4 border-rose-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-rose-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="layers" class="w-6 h-6"></i> Value of Outgoing from VA flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-rose-600 mt-0.5"></i><span><strong>Ensure VA always matches Core:</strong> No virtual overdraft occurs.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-rose-600 mt-0.5"></i><span><strong>Prevent double spending:</strong> Thanks to shadow pending mechanism.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-rose-600 mt-0.5"></i><span><strong>No Core intervention:</strong> Only use DDA accounting like regular transaction.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-rose-600 mt-0.5"></i><span><strong>Full POBO support:</strong> Increase ability to offer Cash Management services.</span></div>
                </div>
                <p class="mt-3 text-rose-900 font-semibold italic text-sm text-center border-t border-rose-200 pt-2">"This sequential flow is a core component of BIDV's new Virtual Account solution"</p>
            </div>
        </div>
        
        <!-- Diagram 9 -->
        <div id="diag-9" class="section-header">12. Diagram #9 – Sequence Interest Allocation</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/09_Sequence_Interest_Allocation.png" alt="Sequence Interest Allocation"><div class="image-caption">Diagram 9/12: Sequence Interest Allocation (Click to zoom)</div></div>
        <div class="mt-6 space-y-6">
            <!-- Intro Block -->
            <div class="bg-orange-50 p-4 rounded-lg text-gray-700 border border-orange-100 shadow-sm italic">
                <p>This diagram demonstrates the interaction sequence between Core Banking, Deposit Core Hub, and Virtual Account Engine when performing interest allocation from real DDA account to Virtual Accounts (VA) belonging to a multi-level structure. This is one of the functions creating the greatest added value for VA service, helping BIDV provide in-depth cash flow management for enterprises.</p>
                <p class="mt-2 font-semibold text-orange-800 text-sm">
                    <span class="uppercase font-bold">Goal:</span> Core calculates real interest → Deposit Core Hub receives → VA allocates interest by rule → Shadow Posting interest to each VA.
                </p>
            </div>

            <!-- Steps Container -->
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Core Banking calculates and records real interest to DDA</h4>
                        <p class="text-sm text-gray-600 mb-2">At end of day/month or by product cycle, Core:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Calculates interest according to deposit product rules.</li>
                            <li>Posts CREDIT interest entry to DDA account.</li>
                            <li>Updates Core Ledger.</li>
                            <li>Emits <strong>InterestCreditedEvent</strong> to Deposit Event Bus.</li>
                        </ul>
                        <div class="mt-2 text-xs bg-orange-50 p-2 rounded border border-orange-100 text-orange-800">
                            Info: DDA, interest amount, calculation period, transaction ID, calculation method.
                        </div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Deposit Event Bus transmits interest event to Routing Hub</h4>
                        <p class="text-sm text-gray-600 mb-2">Event Bus operates as asynchronous intermediary channel:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Pushes interest event in real-time or batch.</li>
                            <li>Ensures no event loss (At-least-once).</li>
                            <li>Allows retry if VA Engine is not ready.</li>
                        </ul>
                        <p class="text-xs italic text-orange-600 mt-2">Routing Hub receives event and starts allocation process.</p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Routing Hub calls Interest Allocation Engine</h4>
                        <p class="text-sm text-gray-600 mb-2">Routing Hub identifies related DDA and queries registered VAs, then sends request to <strong>Interest Allocation Engine</strong>.</p>
                        <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded border">
                            <strong>Transmitted Info:</strong> DDA Number, Interest Amount, Value Date, Interest Period.
                        </div>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Interest Allocation Engine identifies VA list and gets balance</h4>
                        <p class="text-sm text-gray-600 mb-2">Engine performs:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Get list of VAs belonging to DDA and query end-of-period/average balance.</li>
                            <li>Determine allocation method (Pro-rata, Fixed ratio, Weighted...).</li>
                            <li>Calculate interest amount for each VA & Create interest allocation table.</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">Engine sends Shadow Posting interest to VA Engine</h4>
                        <p class="text-sm text-gray-600 mb-2">After calculation, Engine sends request to create virtual entry:</p>
                        <ul class="text-xs text-gray-500 list-disc ml-4 space-y-1">
                            <li>Create <strong>Shadow Posting CREDIT</strong> – Interest Allocation for each VA.</li>
                            <li>Write VA Ledger: VAId, amount, method, allocation ratio.</li>
                        </ul>
                        <p class="text-xs italic text-orange-600 mt-1">VA Engine handles idempotency to avoid duplicate writing.</p>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition">
                        <h4 class="font-bold text-gray-900 mb-1">VA Engine updates balance and roll-up balance</h4>
                        <p class="text-sm text-gray-600 mb-2">VA Engine performs:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-gray-500">
                            <div class="bg-gray-50 p-2 rounded border">Increase balance of VA receiving interest</div>
                            <div class="bg-gray-50 p-2 rounded border">Update roll-up balance of parent VA</div>
                            <div class="bg-gray-50 p-2 rounded border">Log allocation history</div>
                            <div class="bg-gray-50 p-2 rounded border">Confirm completion</div>
                        </div>
                    </div>
                </div>

                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1">
                        <h4 class="font-bold text-green-900 mb-1">Routing Hub receives confirmation & completes flow</h4>
                        <p class="text-sm text-green-800 mb-2">Confirms all VAs have written shadow posting, no allocation errors.</p>
                        <div class="text-xs text-green-700 bg-white p-2 rounded border border-green-100">
                            <strong>Reporting Result:</strong> Interest statement per VA, Allocation report by project, Reconciliation table VA ↔ DDA.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Value Block -->
            <div class="bg-gradient-to-r from-yellow-50 to-amber-50 border-l-4 border-amber-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-amber-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="trending-up" class="w-6 h-6"></i> Value of Interest Allocation flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-amber-600 mt-0.5"></i><span><strong>Cash flow transparency:</strong> Per VA and per level in structure.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-amber-600 mt-0.5"></i><span><strong>Optimal Cash Management:</strong> Especially for multi-unit groups.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-amber-600 mt-0.5"></i><span><strong>No Core Banking impact:</strong> Reduce risk of core system changes.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-amber-600 mt-0.5"></i><span><strong>Easy expansion:</strong> Supports many flexible allocation methods.</span></div>
                </div>
                <p class="mt-3 text-amber-900 font-semibold italic text-sm text-center border-t border-amber-200 pt-2">"Help BIDV provide “sub-ledger interest management” feature — a differentiator compared to most domestic banks."</p>
            </div>
        </div>
    </div>

    <footer class="text-center mt-10 pt-4 border-t border-gray-200 text-gray-500 text-sm">
        Virtual Account System Architecture Document.
        <script>
            lucide.createIcons();
        </script>
    </footer>

</div>

<!-- Scroll To Top Button -->
<button id="scrollTopBtn" title="Go to top"><i data-lucide="arrow-up"></i></button>

<!-- The Modal -->
<div id="myModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>

<script>
    // --- ZOOM IMAGE LOGIC ---
    var modal = document.getElementById("myModal");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    var span = document.getElementsByClassName("close")[0];

    // Delegate click event for images
    document.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('zoomable-image')) {
            modal.style.display = "block";
            modalImg.src = e.target.src;
            captionText.innerHTML = e.target.alt;
        }
    });

    span.onclick = function() { 
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // --- SCROLL TO TOP LOGIC ---
    let mybutton = document.getElementById("scrollTopBtn");

    window.onscroll = function() {scrollFunction()};

    function scrollFunction() {
        if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            mybutton.classList.add("show");
        } else {
            mybutton.classList.remove("show");
        }
    }

    mybutton.addEventListener("click", function() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    });
</script>

</body>
</html>


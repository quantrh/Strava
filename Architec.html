<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiến Trúc Tổng Thể Hệ Thống Virtual Account (VA)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; color: #1f2937; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; background-color: #ffffff; box-shadow: 0 0 20px rgba(0, 0, 0, 0.05); }

        /* Custom Header Styles */
        .main-header { 
            color: #047857; 
            font-weight: 800; 
            text-transform: uppercase; 
            font-size: 1.75rem; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            margin-top: 0.5rem; 
            margin-bottom: 1.5rem; 
            border-bottom: 4px solid #10b981; 
            padding-bottom: 1rem;
        }
        
        .sub-header {
            font-size: 1.35rem; 
            font-weight: 700; 
            color: #1f2937; 
            margin-top: 2.5rem; 
            margin-bottom: 1rem; 
            border-left: 5px solid #3b82f6; 
            padding-left: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-header {
            font-size: 1.15rem; 
            font-weight: 600; 
            color: #374151; 
            margin-top: 1.5rem; 
            margin-bottom: 0.5rem; 
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #e5e7eb;
        }

        /* Image Box Styles */
        .image-container {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative; /* For hover effect context */
        }
        
        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
            cursor: zoom-in; /* Indicate zoomable */
        }

        .image-container:hover img {
            opacity: 0.95;
        }

        .image-caption {
            background-color: #f9fafb;
            padding: 0.75rem;
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
            font-style: italic;
        }

        /* Modal / Lightbox Styles */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            padding-top: 50px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.85); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 1200px;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation-name: zoom;
            animation-duration: 0.3s;
        }

        @keyframes zoom {
            from {transform:scale(0.8); opacity: 0;} 
            to {transform:scale(1); opacity: 1;}
        }

        .close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 1001;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* Caption inside modal */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }

        .summary-block {
            background-color: #ecfdf5;
            border: 2px solid #10b981;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }

        .summary-title {
            color: #047857;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #6ee7b7;
        }

        .group-title {
            color: #1d4ed8;
            font-weight: 700;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .diagram-list li {
            margin-left: 1.5rem;
            list-style: disc;
            margin-top: 0.25rem;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">

    <!-- LANGUAGE SWITCHER (Optional Visual Helper) -->
    <div class="flex justify-end pt-4 px-4 gap-2">
        <button onclick="setLanguage('vi')" class="text-xs font-bold px-2 py-1 rounded bg-gray-200 hover:bg-green-100 text-gray-700">Tiếng Việt</button>
        <button onclick="setLanguage('en')" class="text-xs font-bold px-2 py-1 rounded bg-gray-200 hover:bg-blue-100 text-gray-700">English</button>
    </div>

    <!-- ==================================================================================== -->
    <!-- CONTENT VIETNAMESE -->
    <!-- ==================================================================================== -->
    <div id="content-vi">
        <header class="text-center py-6">
            <h1 class="main-header justify-center">Thiết Kế Kiến Trúc Hệ Thống Virtual Account</h1>
        </header>

        <!-- KHỐI NỘI DUNG TỔNG HỢP -->
        <div class="summary-block">
            <div class="summary-title">TỔNG HỢP KIẾN THỨC VỀ 12 SƠ ĐỒ KIẾN TRÚC & QUY TRÌNH</div>
            <p class="text-gray-700 mb-4">
                Toàn bộ 12 sơ đồ được chia thành <strong>2 nhóm lớn</strong> theo mục đích:
            </p>
            
            <div class="group-title text-indigo-700">I. Nhóm 1 – Sơ đồ Tổng Thể (Macro Architecture)</div>
            <p class="text-sm text-gray-600 italic">Gồm 4 sơ đồ: Sơ đồ #1, #2, #10, #11</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Mục đích của nhóm</p>
                <ul class="diagram-list">
                    <li>Trình bày bức tranh tổng thể hệ thống (landscape)</li>
                    <li>Thể hiện ranh giới giữa Core Banking và Deposit Core Hub</li>
                    <li>Là cơ sở để Hội đồng Kiến trúc và Ban Lãnh đạo phê duyệt hướng thiết kế</li>
                    <li>Giúp tất cả đội kỹ thuật (Core, Integration, Digital Channels, BA/Dev/QA) hiểu cách hệ thống vận hành ở mức kiến trúc</li>
                </ul>
                <p class="font-medium mt-2">2. Danh sách sơ đồ trong nhóm</p>
                <ul class="diagram-list">
                    <li><span class="font-semibold text-green-700">Sơ đồ số 1 – Overall System Landscape / Core Banking Super Layer:</span> Giới thiệu BIG PICTURE toàn hệ thống. Các lớp: Channels → API Gateway → Routing Hub → Deposit Core Hub → Core Banking → Data Layer. Chỉ rõ VA thuộc lớp nào và Core làm nhiệm vụ gì. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Sơ đồ số 2 – Logical Architecture (Deposit Core Hub + VA):</span> Mô tả các module chính: Routing Hub, VA Engine, DDA Handler, Interest Engine. Ranh giới logic giữa lớp Hub và Core. Giải thích trách nhiệm từng thành phần. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Sơ đồ số 10 – Data Model VA (ERD):</span> ERD tổng quan: VA, VA Ledger, VA Balance, Hierarchy, Enrollment, Identifier… Cho thấy cách dữ liệu VA được tổ chức. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Sơ đồ số 11 – Logical ERD Chi tiết:</span> Phiên bản chi tiết chuyên sâu hơn của ERD tổng quan (Sơ đồ #10). Thể hiện đầy đủ quan hệ giữa các bảng, các module logic. Rất hữu ích cho đội Data, BA, và Dev. Should-have.</li>
                </ul>
            </div>

            <div class="group-title text-indigo-700">II. Nhóm 2 – Sơ đồ Kiến trúc Logic & Luồng Xử lý Nghiệp vụ</div>
            <p class="text-sm text-gray-600 italic">Gồm 8 sơ đồ: #3 → #9 + #12 (Trong đó, #7, #8, #9 là Sequence Diagram)</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Mục đích của nhóm</p>
                <ul class="diagram-list">
                    <li>Mô tả chi tiết từng luồng nghiệp vụ mà Virtual Account phải hỗ trợ</li>
                    <li>Thể hiện tương tác giữa system components</li>
                    <li>Giúp đội BA/Dev/QA xây dựng, test, và báo cáo hệ thống</li>
                    <li>Đảm bảo các case nghiệp vụ đáp ứng chuẩn quốc tế về VA</li>
                </ul>
                <p class="font-medium mt-2">2. Danh sách sơ đồ trong nhóm</p>
                <ul class="diagram-list">
                    <li><span class="font-semibold text-red-700">Sơ đồ số 3 – VA-first Incoming Flow:</span> Luồng khi khách hàng nhập số VA trực tiếp. Routing → Validate VA → Core hạch toán → Event → Shadow Posting. Chuẩn quốc tế, đảm bảo không lạc VA. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 4 – DDA-first Incoming Flow:</span> Khi khách hàng chỉ nhập số DDA + remark. Core ghi có trước → Routing Hub tìm VA → VA ghi shadow. Hỗ trợ kênh liên ngân hàng không hỗ trợ VA. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 5 – Outgoing từ VA:</span> VA kiểm soát số dư → Shadow Debit → Core Debit DDA → Confirm. Phù hợp POBO, chi hộ, chuyển khoản từ VA. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 6 – Interest Allocation Flow:</span> Core tính lãi trên DDA → Routing Hub → VA Alloc Engine → Shadow Posting. Hỗ trợ mô hình chia lãi theo dự án/hộ gia đình/đơn vị. Should-have (nhưng quan trọng).</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 7 – Sequence VA-first:</span> Sequence Diagram mô tả tuần tự tương tác (của Sơ đồ #3). Phục vụ Dev/QA xây dựng API & xử lý lỗi. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 8 – Sequence Outgoing VA:</span> Toàn bộ logic chi từ VA theo dòng tuần tự (của Sơ đồ #5). Giúp đội kỹ thuật kiểm soát pending/confirmed debit. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 9 – Sequence Interest Allocation:</span> Chi tiết tính toán và phân bổ lãi (của Sơ đồ #6). Hỗ trợ kiểm toán, reconciliation. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Sơ đồ số 12 – Integration & Deployment Architecture:</span> Mô tả triển khai thực tế: container, scaling, HA/DR. Quan trọng cho DevOps, hạ tầng. Must-have.</li>
                </ul>
            </div>
        </div>

        <h2 class="sub-header">
            <i data-lucide="layout-grid" class="w-6 h-6 text-blue-500"></i>
            I. Nhóm 1 – Sơ đồ Tổng Thể (Macro Architecture)
        </h2>
        <p class="pl-2 text-gray-700 italic">Các sơ đồ này trình bày bức tranh tổng thể hệ thống, kiến trúc logic và lớp dữ liệu (Sơ đồ #1, #2, #10, #11).</p>

        <!-- Sơ đồ số 1 -->
        <div class="section-header">1. Sơ đồ số 1 – Overall System Landscape / Core Banking Super Layer</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/01_Overall_System_Landscape.png" alt="Overall System Landscape">
            <div class="image-caption">Sơ đồ 1/12: Overall System Landscape / Core Banking Super Layer (Click để phóng to)</div>
        </div>
        
        <div class="mt-8 space-y-8">
            <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600 shadow-sm">
                <h3 class="text-xl font-bold text-blue-800 uppercase mb-3 flex items-center gap-2">
                    <i data-lucide="target" class="w-6 h-6"></i> Mục tiêu kiến trúc
                </h3>
                <p class="mb-4 text-gray-800">
                    Mô hình <span class="font-bold text-blue-700">“Core Banking Super Layer”</span> giúp ngân hàng tách biệt lớp lõi kế toán với các lớp dịch vụ bám theo, tạo điều kiện phát triển sản phẩm mới nhanh chóng mà không tác động trực tiếp vào Core. Kiến trúc này nhằm:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="flex items-start gap-2"><i data-lucide="shield-check" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Bảo vệ Core Banking khỏi tải lớn và rủi ro thay đổi</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="settings-2" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Chuẩn hóa điểm giao tiếp giữa kênh – hệ thống – Core</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="zap" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Tăng tốc đổi mới sản phẩm (Virtual Account, Alias Account, Fee Engine…)</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="trending-up" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Nâng cao trải nghiệm doanh nghiệp và khả năng cạnh tranh</span></div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Các lớp chính của kiến trúc</h3>
                <div class="space-y-3">
                    <div class="bg-white border border-gray-200 rounded-md p-4 flex flex-col md:flex-row gap-4 hover:shadow-md transition">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-700">Channel Layer</span>
                            <div class="font-bold text-lg text-gray-900">Lớp Kênh</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-100 pl-0 md:pl-4">
                            <p class="mb-1">Bao gồm iBank, H2H, Mobile, Teller, kênh liên ngân hàng…</p>
                            <p class="text-sm italic text-gray-500">→ Gửi mọi giao dịch thông qua API Gateway, không kết nối trực tiếp Core.</p>
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-md p-4 flex flex-col md:flex-row gap-4 hover:shadow-md transition">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-700">Integration</span>
                            <div class="font-bold text-lg text-gray-900">API Gateway / ESB</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-100 pl-0 md:pl-4">
                            <p class="mb-1">Thực hiện điều phối, xác thực, bảo vệ Core khỏi truy cập trực tiếp.</p>
                            <p class="text-sm font-semibold text-blue-600">→ Là “cửa duy nhất” của toàn bộ giao dịch tiền gửi.</p>
                        </div>
                    </div>
                    <div class="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-5 flex flex-col gap-4 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-indigo-500 text-white text-xs font-bold px-2 py-1 rounded-bl">SUPER LAYER</div>
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="md:w-1/4">
                                <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-indigo-100 text-indigo-800">Core Hub</span>
                                <div class="font-bold text-xl text-indigo-900 mt-1">Deposit Core Hub</div>
                                <p class="text-sm text-indigo-700 mt-2">Đây là lớp trọng yếu, nằm giữa kênh và Core.</p>
                            </div>
                            <div class="md:w-3/4 border-l-2 border-indigo-200 pl-0 md:pl-4">
                                <p class="font-semibold text-indigo-900 mb-2">Chức năng chính:</p>
                                <ul class="space-y-2 text-gray-700">
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>Routing Hub:</strong> Điều phối các luồng nộp – chi – VA-first – DDA-first</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>VA Engine:</strong> Quản lý Virtual Account, shadow posting, số dư real/roll-up</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>Interest Allocation:</strong> Phân bổ lãi từ DDA xuống VA</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>DDA Handler:</strong> Xử lý các giao dịch ghi vào DDA theo logic mở rộng</span></li>
                                </ul>
                                <p class="mt-3 text-sm font-medium text-indigo-800 bg-indigo-100 p-2 rounded">→ Cho phép phát triển tính năng mới mà không sửa Core, giảm rủi ro và tăng tốc triển khai.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-50 border border-slate-300 rounded-md p-4 flex flex-col md:flex-row gap-4">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-slate-200 text-slate-700">Backend</span>
                            <div class="font-bold text-lg text-slate-900">Core Banking Layer</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-200 pl-0 md:pl-4">
                            <p class="mb-2 italic">Core chỉ làm đúng nhiệm vụ kế toán và hạch toán thật:</p>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Ghi Có/Ghi Nợ DDA</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Tính lãi thật</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Phát sự kiện (posting)</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Bảo đảm toàn vẹn sổ cái</div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pt-2">
                        <div class="bg-orange-50 border border-orange-200 rounded p-3">
                            <div class="font-bold text-orange-800 mb-1 flex items-center gap-2"><i data-lucide="activity" class="w-4 h-4"></i> Event Bus</div>
                            <p class="text-sm text-gray-700">Cung cấp cơ chế bất đồng bộ để đồng bộ giao dịch giữa Core và Super Layer.</p>
                            <p class="text-xs text-orange-600 mt-1 font-semibold">→ Tăng tính mở rộng, giảm nghẽn.</p>
                        </div>
                        <div class="bg-cyan-50 border border-cyan-200 rounded p-3">
                            <div class="font-bold text-cyan-800 mb-1 flex items-center gap-2"><i data-lucide="database" class="w-4 h-4"></i> Data Layer</div>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li><strong>Core DB:</strong> DDA ledger – sổ cái chuẩn kiểm toán</li>
                                <li><strong>VA DB:</strong> VA ledger (shadow), registry, mapping</li>
                            </ul>
                            <p class="text-xs text-cyan-600 mt-1 font-semibold">→ Tách biệt để Core ổn định, VA linh hoạt.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-emerald-800 mb-4 flex items-center gap-2 border-b-2 border-emerald-100 pb-2">
                    <i data-lucide="thumbs-up" class="w-6 h-6"></i> Lợi ích tổng thể cho ngân hàng
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Bảo vệ Core – Giảm rủi ro</h4><p class="text-sm text-gray-600">Core ít thay đổi, tránh ảnh hưởng nâng cấp và rủi ro lỗi hệ thống.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Nền tảng mở cho SP mới</h4><p class="text-sm text-gray-600">Virtual Account, Alias, Fee Engine… triển khai nhanh, không chạm Core.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Tăng hiệu năng & mở rộng</h4><p class="text-sm text-gray-600">Super Layer xử lý nghiệp vụ số lượng lớn, Core tập trung vào ledger → hiệu suất tốt hơn.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Chuẩn hóa tích hợp đa kênh</h4><p class="text-sm text-gray-600">Giao dịch đi theo luồng thống nhất, dễ vận hành và kiểm soát.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500 lg:col-span-2"><h4 class="font-bold text-gray-800 mb-2">Nâng cấp mô hình công nghệ</h4><p class="text-sm text-gray-600">Tiệm cận kiến trúc ngân hàng quốc tế: tách lớp, event-driven, microservices.</p></div>
                </div>
            </div>

            <div class="bg-gray-800 text-white rounded-lg p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-3 flex items-center gap-2 text-yellow-400"><i data-lucide="flag" class="w-6 h-6"></i> Kết luận định hướng</h3>
                <p class="mb-4 text-gray-300">Kiến trúc Core Banking Super Layer không chỉ giải quyết nhu cầu hiện tại (Virtual Account, Cash Management) mà còn là nền tảng lâu dài cho chiến lược chuyển đổi số, giúp BIDV:</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Giảm phụ thuộc</div><div class="text-xs text-gray-400">vào nhà cung cấp Core</div></div>
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Chủ động mở rộng</div><div class="text-xs text-gray-400">sản phẩm theo thị trường</div></div>
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Ổn định vận hành</div><div class="text-xs text-gray-400">cấp độ hệ thống trọng yếu</div></div>
                </div>
                <p class="text-sm text-gray-400 italic text-center border-t border-gray-700 pt-3">"Đây là mô hình phù hợp cho các ngân hàng muốn phát triển mạnh dịch vụ giao dịch doanh nghiệp và mở rộng nền tảng ngân hàng số"</p>
            </div>
        </div>

        <!-- Sơ đồ số 2 -->
        <div class="section-header">2. Sơ đồ số 2 – Logical Architecture (Deposit Core Hub + VA)</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/02_Logical_Architecture_DepositCoreHub_VA.png" alt="Logical Architecture">
            <div class="image-caption">Sơ đồ 2/12: Logical Architecture (Deposit Core Hub + VA) (Click để phóng to)</div>
        </div>
        <div class="mt-6 space-y-6">
            <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500 text-gray-700">
                <p>Sơ đồ mô tả kiến trúc logic của lớp <span class="font-bold text-indigo-700">Deposit Core Hub</span> – một “lớp siêu nghiệp vụ” được xây dựng bao quanh phân hệ Tiền gửi (Deposit Module) của Core Banking, cho phép BIDV phát triển nhanh các sản phẩm thu – chi hiện đại, đặc biệt là <span class="font-bold">Virtual Account (VA)</span>, mà không phải chỉnh sửa Core.</p>
            </div>
            <h3 class="font-bold text-xl text-gray-800 border-b border-gray-200 pb-2">4 Khối Năng Lực Chính</h3>
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-3"><div class="bg-purple-100 p-2 rounded-full text-purple-600"><i data-lucide="route" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-purple-900">Routing Hub – Bộ não điều hướng & kiểm soát</h4></div>
                <p class="text-gray-600 mb-3 italic">Đóng vai trò điểm trung gian bắt buộc cho mọi giao dịch thu – chi sử dụng VA.</p>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Kiểm tra loại giao dịch: <span class="font-medium">VA-first</span> hay <span class="font-medium">DDA-first</span>.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Gọi VA Engine để xác thực số VA trước khi gửi hạch toán sang Core.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Xác định tài khoản DDA thực tương ứng (Mapped DDA).</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Tiếp nhận sự kiện từ Core để chuyển tiếp cho VA Engine cập nhật ledger ảo.</span></li>
                </ul>
                <div class="mt-3 text-sm font-medium text-purple-800 bg-purple-50 p-2 rounded border border-purple-100">→ Giúp tách nghiệp vụ mở rộng khỏi Core, đồng thời đảm bảo luồng xử lý thống nhất cho toàn bộ kênh giao dịch.</div>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-4"><div class="bg-blue-100 p-2 rounded-full text-blue-600"><i data-lucide="cpu" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-blue-900">Virtual Account Engine – Trái tim nghiệp vụ VA</h4></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Incoming Service</div><p class="text-xs text-gray-600">Tiếp nhận giao dịch đầu vào, xác thực VA, tìm kiếm Mapped DDA, trả kết quả cho Routing Hub.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Outgoing Service</div><p class="text-xs text-gray-600">Xử lý lệnh chi, kiểm tra số dư real/roll-up, ghi shadow debit, và gọi Core để trích nợ thật DDA.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">Shadow Posting Engine</div><p class="text-xs text-gray-600">Tạo bút toán ảo; cập nhật số dư VA và số dư roll-up theo cây VA nhiều cấp (3–5 cấp).</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Balance Engine</div><p class="text-xs text-gray-600">Tính toán số dư tức thời, đồng bộ với Ledger ảo và sự kiện từ Core.</p></div>
                </div>
                <p class="mt-4 text-sm text-blue-800 font-medium px-2">→ VA Engine hoạt động độc lập với Core, giúp BIDV linh hoạt mở rộng tính năng mà không ảnh hưởng đến hệ lõi.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-slate-800 font-bold"><i data-lucide="server" class="w-5 h-5"></i> Core Banking Layer</div>
                    <p class="text-xs text-slate-500 mb-2 uppercase font-bold tracking-wide border-b border-slate-200 pb-1">Nơi ghi nhận bút toán thật</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Deposit Module:</strong> hạch toán thực trên tài khoản DDA.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Event Bus:</strong> phát tín hiệu “Credit/Debit Notification” mỗi khi Core hoàn tất giao dịch.</span></li>
                    </ul>
                    <div class="text-xs italic text-slate-600 bg-white p-2 rounded border border-slate-100">Core chỉ thực hiện nhiệm vụ kế toán; mọi logic điều phối, mapping, đối soát và xử lý ảo đều nằm ở Deposit Core Hub.</div>
                </div>
                <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-cyan-800 font-bold"><i data-lucide="database" class="w-5 h-5"></i> Data Layer</div>
                    <p class="text-xs text-cyan-600 mb-2 uppercase font-bold tracking-wide border-b border-cyan-200 pb-1">Phân tách ledger thật và ảo</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>Core Ledger:</strong> số dư và giao dịch thật của DDA.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>VA Ledger (Shadow):</strong> bút toán ảo cho từng VA và từng level trong hệ thống.</span></li>
                    </ul>
                    <div class="text-xs italic text-cyan-700 bg-white p-2 rounded border border-cyan-100">Cách tách biệt này giúp VA mở rộng linh hoạt, không gây rủi ro cho Core Banking.</div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-5 shadow-sm">
                <h4 class="text-green-800 font-bold text-lg mb-3 flex items-center gap-2"><i data-lucide="gem" class="w-5 h-5"></i> Tóm lược giá trị kiến trúc</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Tách biệt nghiệp vụ khỏi Core, giảm tải và giảm thay đổi cho hệ lõi.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Hỗ trợ hai mô hình giao dịch: VA-first và DDA-first.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Đảm bảo vận hành real-time, minh bạch và dễ kiểm soát.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Tạo nền tảng cho nhiều sản phẩm mới: thu hộ/chi hộ, pooling, quản lý dòng tiền.</span></div>
                </div>
                <div class="mt-4 pt-3 border-t border-green-200 text-center text-green-900 font-bold italic text-sm">"Đây là kiến trúc đột phá, giúp BIDV hiện đại hóa phân hệ tiền gửi và sẵn sàng cho chiến lược ngân hàng giao dịch số."</div>
            </div>
        </div>

        <!-- Sơ đồ số 3-12 (Giữ nguyên nội dung tiếng Việt) -->
        <!-- Sơ đồ 10 -->
        <div class="section-header">3. Sơ đồ số 10 – Data Model VA (ERD)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/10_Data_Model_VA_Conceptual.png" alt="Data Model VA (ERD)"><div class="image-caption">Sơ đồ 10/12: Data Model VA (ERD) & Data Flow (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Kiến trúc Tách bạch Dữ liệu (Decoupled Data Layer)</p>
            <p>Kiến trúc dữ liệu được thiết kế tách biệt hoàn toàn. Sơ đồ này cho thấy cấu trúc ERD tổng quan, bao gồm các bảng VA, VA Ledger, VA Balance, Hierarchy, và các quan hệ với DDA.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Core Banking DB:</span> Chứa <span class="text-green-700 font-bold">DDA ledger (sổ cái thật)</span>, là nguồn dữ liệu chuẩn mực duy nhất để kiểm toán.</li>
                <li><span class="font-bold">VA DB:</span> Chứa <span class="text-green-700 font-bold">VA ledger (sổ cái ảo)</span>, registry, mapping (ánh xạ VA-DDA), và các quy tắc nghiệp vụ (rules). Tối ưu cho tốc độ tra cứu.</li>
                <li><span class="font-bold">Reporting DB / Data Mart:</span> Dữ liệu tổng hợp từ cả Core và VA để phục vụ các báo cáo quản trị (BI) mà không ảnh hưởng đến hiệu năng giao dịch.</li>
            </ul>
        </div>

        <!-- Sơ đồ 11 -->
        <div class="section-header">4. Sơ đồ số 11 – Deployment Architecture</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/11_Logical_ERD_VA_Detail.png" alt="Logical ERD Detail"><div class="image-caption">Sơ đồ 11/12: Deployment Architecture (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Mô hình Triển khai Hiện đại (Deployment & Integration)</p>
            <p>Deposit Core Hub (Super Layer) được triển khai trên nền tảng hiện đại, tách biệt với môi trường Core Banking truyền thống. Sơ đồ này mô tả chi tiết cách hệ thống được triển khai và vận hành.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Containerized:</span> Sử dụng Docker/Kubernetes cho VA Engine & Routing Hub.</li>
                <li><span class="font-bold">Scaling độc lập:</span> Khả năng mở rộng (Scaling) độc lập theo từng microservice (Incoming Flow, Outgoing Flow, Lookup Services...).</li>
                <li><span class="font-bold">Zero-downtime deployment:</span> Áp dụng phương pháp Rolling Update hoặc Blue/Green.</li>
                <li><span class="font-bold">HA & DR:</span> Triển khai theo mô hình Multinode Cluster (High Availability) và đồng bộ với DR Site (Disaster Recovery).</li>
            </ul>
        </div>

        <!-- Sơ đồ 12 -->
        <div class="section-header">5. Sơ đồ số 12 – Integration & Deployment Architecture (Cơ chế Tích hợp)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/12_Integration_Deployment_VA_DepositCoreHub.png" alt="Integration & Deployment"><div class="image-caption">Sơ đồ 12/12: Integration Architecture (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Cơ chế Tích hợp Bất Đồng Bộ (Event-Driven)</p>
            <p>Kiến trúc tích hợp Event-Driven (dựa trên Event Bus như Kafka) là mấu chốt để đạt được hiệu năng và tính ổn định, giảm độ phụ thuộc đồng bộ giữa hai hệ thống Core và Super Layer.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Core to Super Layer:</span> Core Banking phát các sự kiện (posting, interest) lên Event Bus sau khi hoàn thành hạch toán sổ cái thật (DDA).</li>
                <li><span class="font-bold">Super Layer Listener:</span> VA Engine lắng nghe sự kiện. Chỉ khi nhận được sự kiện xác nhận Ghi Có/Ghi Nợ thành công từ Core, VA Engine mới tiến hành Ghi Có/Ghi Nợ vào <span class="text-indigo-700 font-semibold">VA Ledger (sổ cái ảo)</span>.</li>
                <li><span class="font-bold">Đảm bảo:</span> Cơ chế <span class="font-semibold text-red-700">at-least-once delivery</span> và retry để duy trì tính toàn vẹn của giao dịch.</li>
            </ul>
        </div>

        <h2 class="sub-header"><i data-lucide="trello" class="w-6 h-6 text-indigo-500"></i> II. Nhóm 2 – Sơ đồ Kiến trúc Logic & Luồng Xử lý Nghiệp vụ</h2>
        <p class="pl-2 text-gray-700 italic">Các sơ đồ này mô tả chi tiết từng luồng nghiệp vụ, bao gồm luồng giao dịch, quản lý VA và đối chiếu (Sơ đồ #3 $\to$ #9).</p>

        <!-- Sơ đồ 3 -->
        <div class="section-header">6. Sơ đồ số 3 – Flow #1: VA-first Incoming (Nộp tiền vào VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/03_Flow_VA_First_Incoming.png" alt="VA-first Incoming Flow"><div class="image-caption">Sơ đồ 3/12: VA-first Incoming Flow (Nộp tiền vào VA) (Click để phóng to)</div></div>
        <div class="mt-6 space-y-6">
            <div class="bg-blue-50 p-4 rounded-lg text-gray-700 border border-blue-100 shadow-sm italic">
                <p>Sơ đồ này mô tả luồng xử lý khi khách hàng chủ động nhập số <span class="font-semibold text-blue-700">Virtual Account (VA)</span> trên kênh giao dịch (Internet Banking, H2H, API, quầy…). Đây là mô hình chuẩn quốc tế (“VA-first”), đảm bảo giao dịch được kiểm tra tính hợp lệ ngay từ đầu, giúp giảm sai sót và giảm chi phí tra soát.</p>
            </div>
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Kênh giao dịch gửi yêu cầu theo số VA</h4><p class="text-sm text-gray-600 mb-2">Khách hàng nhập trực tiếp số VA thay vì số DDA thực.</p><ul class="text-xs text-gray-500 list-disc ml-4"><li>Thông tin: Số VA, Số tiền, Người gửi/nhận, Tham chiếu, Nghiệp vụ thu hộ...</li><li class="italic text-blue-600 mt-1">→ Kênh không xử lý, chuyển toàn bộ request vào Routing Hub.</li></ul></div>
                </div>
                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub gửi yêu cầu xác thực sang VA Engine</h4><p class="text-sm text-gray-600 mb-2">Routing Hub thực hiện vai trò “chốt chặn” nghiệp vụ:</p><ul class="text-xs text-gray-500 list-disc ml-4 space-y-1"><li>Gọi dịch vụ Validate VA tại VA Engine.</li><li>Kiểm tra: Tồn tại, Trạng thái (Hoạt động/Khóa), Ràng buộc (Thu/Chi/Hạn mức).</li><li>Xác định <span class="font-semibold text-gray-700">Mapped DDA</span> – tài khoản thật gắn với VA.</li></ul><div class="flex gap-2 mt-2 text-xs font-semibold"><span class="text-red-600 bg-red-50 px-2 py-1 rounded">Không hợp lệ → Trả lỗi ngay</span><span class="text-green-600 bg-green-50 px-2 py-1 rounded">Hợp lệ → Lấy DDA & tiếp tục</span></div></div>
                </div>
                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub hạch toán Credit vào DDA qua Core Banking</h4><p class="text-sm text-gray-600">Routing Hub sử dụng Mapped DDA để gọi Core:</p><ul class="text-xs text-gray-500 list-disc ml-4 mt-1"><li>Thực hiện ghi Có vào DDA (hạch toán thật).</li><li>Lưu bút toán tại Core.</li><li>Kiểm tra hạn mức, trạng thái tài khoản thật.</li></ul></div>
                </div>
                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Core Banking phát sự kiện Credit Notification</h4><p class="text-sm text-gray-600">Sau khi hạch toán thành công, Core phát event lên Event Bus:</p><div class="mt-2 text-xs bg-gray-50 p-2 rounded border text-gray-600 font-mono">{ Loại giao dịch, Số dư mới, Số tiền, Txn ID, DDA }</div><p class="text-xs text-gray-500 mt-1 italic">→ Sự kiện được chuyển đến Routing Hub để xử lý tiếp cho VA.</p></div>
                </div>
                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub thông báo Post-Notification cho VA Engine</h4><p class="text-sm text-gray-600">Xác nhận bút toán Core thành công & gửi thông tin để VA ghi ledger.</p><p class="text-xs text-indigo-600 font-semibold mt-1 bg-indigo-50 inline-block px-2 py-1 rounded">Đảm bảo: Không ghi trước - Không ghi 2 lần - Chỉ ghi khi Core thành công.</p></div>
                </div>
                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">VA Engine ghi Shadow Posting & cập nhật số dư</h4><div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2"><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>1. Tạo Shadow Posting (Credit)</strong><br>Lưu vào VA Ledger.</div><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>2. Cập nhật Số Dư</strong><br>VA nhận tiền & Roll-up balance cấp cha.</div></div><p class="text-xs text-gray-500 mt-2 italic">Cơ chế Idempotency đảm bảo mỗi giao dịch Core tương ứng đúng 1 shadow posting.</p></div>
                </div>
                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1"><h4 class="font-bold text-green-900 mb-1">Luồng giao dịch hoàn tất</h4><ul class="text-sm text-green-800 list-disc ml-4"><li>Sổ cái Core & Sổ cái ảo VA được cập nhật.</li><li>Số dư VA các cấp đồng bộ gần real-time.</li><li>Giao dịch hiển thị đúng cho khách hàng ở cấp VA tương ứng.</li></ul></div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-emerald-50 to-green-50 border-l-4 border-emerald-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-emerald-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="award" class="w-6 h-6"></i> Giá trị của luồng VA-first</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Không có giao dịch “lạc VA”:</strong> VA được kiểm tra trước khi vào Core.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Tốc độ đối soát nhanh:</strong> VA biết chính xác giao dịch thuộc về ai.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Tiết kiệm chi phí vận hành:</strong> Giảm tra soát thủ công.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Linh hoạt mở rộng:</strong> Không yêu cầu sửa logic tại Core.</span></div>
                </div>
                <p class="mt-3 text-emerald-900 font-semibold italic text-sm text-center border-t border-emerald-200 pt-2">"Luồng này là trụ cột chính trong thiết kế Deposit Core Hub và giải pháp Virtual Account của BIDV"</p>
            </div>
        </div>

        <!-- Sơ đồ 4 -->
        <div class="section-header">7. Sơ đồ số 4 – VA-first Incoming Flow (Credit to VA)</div>
        <p class="text-gray-700 italic">Quy trình xử lý giao dịch ghi Có vào VA khi VA được định danh trực tiếp.</p>
        <div class="image-container"><img class="zoomable-image" src="./Picture/04_Flow_DDA_First_Incoming.png" alt="DDA-first Incoming Flow"><div class="image-caption">Sơ đồ 4/12: VA-first Incoming Flow (Credit to VA) (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Quy trình Giao dịch Ghi Có VA-first</p>
            <p>Đây là luồng chuẩn quốc tế khi VA được sử dụng làm tài khoản đích:</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Routing & Mapping:</span> Routing Hub nhận dạng tài khoản VA và ánh xạ về DDA thật tương ứng tại Core.</li>
                <li><span class="font-bold">2. Core Posting:</span> Thực hiện giao dịch <span class="text-green-700 font-semibold">Ghi Có (Credit)</span> vào tài khoản DDA thật tại Core Banking.</li>
                <li><span class="font-bold">3. Event & Shadow Posting:</span> Core phát sự kiện. VA Engine lắng nghe và Ghi Có vào <span class="text-indigo-700 font-semibold">VA Ledger (sổ cái ảo)</span>.</li>
            </ul>
        </div>

        <!-- Sơ đồ 5 -->
        <div class="section-header">8. Sơ đồ số 5 – Outgoing từ VA (Debit from VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/05_Flow_Outgoing_From_VA.png" alt="Outgoing from VA"><div class="image-caption">Sơ đồ 5/12: Outgoing Transaction Flow (Debit from VA) (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Quy tắc VA-first cho Ghi Nợ</p>
            <p>Giao dịch Ghi Nợ phải tuân theo quy tắc VA-first để đảm bảo VA không bị âm sổ ảo và DDA thật có đủ số dư:</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. VA Engine Validation:</span> VA Engine kiểm tra <span class="text-red-700 font-semibold">Số Dư Khả Dụng</span> của VA trong sổ cái ảo. Nếu không đủ, giao dịch bị từ chối ngay.</li>
                <li><span class="font-bold">2. Core Posting:</span> Nếu đủ, Core Banking thực hiện giao dịch <span class="text-red-700 font-semibold">Ghi Nợ (Debit)</span> vào tài khoản DDA thật.</li>
                <li><span class="font-bold">3. Event & Shadow Posting:</span> Core phát sự kiện. VA Engine Ghi Nợ vào <span class="text-indigo-700 font-semibold">VA Ledger (sổ cái ảo)</span>.</li>
            </ul>
        </div>

        <!-- Sơ đồ 6 -->
        <div class="section-header">9. Sơ đồ số 6 – Interest Allocation Flow</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/06_Flow_Interest_Allocation.png" alt="Interest Allocation Flow"><div class="image-caption">Sơ đồ 6/12: Interest Allocation Flow (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Phân bổ Lãi/Phí</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Core Banking:</span> Tính lãi và hạch toán lãi/phí vào tài khoản <span class="text-green-700 font-semibold">DDA thật</span>, sau đó phát sự kiện (interest/fee event).</li>
                <li><span class="font-bold">2. VA Engine (Interest Allocation):</span> Lắng nghe sự kiện. Thực hiện logic nghiệp vụ để phân bổ số lãi/phí nhận được từ DDA thật xuống từng VA Con (dựa trên tỷ lệ số dư trung bình).</li>
                <li><span class="font-bold">3. Ghi sổ ảo:</span> Ghi Có (lãi) hoặc Ghi Nợ (phí) vào <span class="text-indigo-700 font-semibold">VA Ledger</span> của từng VA Con.</li>
            </ul>
        </div>

        <!-- Sơ đồ 7 -->
        <div class="section-header">10. Sơ đồ số 7 – Reconciliation Mechanism (Cơ chế Đối chiếu)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/07_Sequence_VA_First.png" alt="Sequence VA First"><div class="image-caption">Sơ đồ 7/12: Reconciliation Mechanism (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Đảm bảo Đồng bộ Sổ cái</p>
            <p>Vì giao dịch được xử lý bất đồng bộ, một cơ chế đối chiếu tự động là bắt buộc.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Đối chiếu theo Sự kiện:</span> Mỗi sự kiện từ Core Banking (Ghi Có/Ghi Nợ DDA) phải có một bản ghi tương ứng trong VA Ledger.</li>
                <li><span class="font-bold">2. Đối chiếu Định kỳ (EOD):</span> Xác nhận <span class="text-red-700 font-semibold">Tổng Số dư Thực của tất cả VA Con = Số dư DDA Thực tế tại Core</span>.</li>
                <li><span class="font-bold">3. Xử lý Chênh lệch:</span> Tự động phát cảnh báo và kích hoạt quy trình điều chỉnh nếu chênh lệch xảy ra.</li>
            </ul>
        </div>

        <!-- Sơ đồ 8 -->
        <div class="section-header">11. Sơ đồ số 8 – VA Lifecycle (Vòng đời VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/08_Sequence_Outgoing_VA.png" alt="Sequence Outgoing VA"><div class="image-caption">Sơ đồ 8/12: VA Lifecycle (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Các Trạng thái và Chuyển đổi Trạng thái VA</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold text-green-700">Created (Khởi tạo):</span> VA được tạo nhưng chưa kích hoạt.</li>
                <li><span class="font-bold text-green-700">Active (Hoạt động):</span> Sẵn sàng cho giao dịch Ghi Có/Ghi Nợ.</li>
                <li><span class="font-bold text-red-700">Inactive/Frozen (Tạm khóa):</span> VA bị tạm khóa (có thể cho Ghi Có, không cho Ghi Nợ).</li>
                <li><span class="font-bold text-red-700">Closed (Đã đóng):</span> VA đã bị đóng vĩnh viễn, không thể giao dịch.</li>
            </ul>
        </div>
        
        <!-- Sơ đồ 9 -->
        <div class="section-header">12. Sơ đồ số 9 – VA Hierarchy & Management (Cấu trúc Phân cấp)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/09_Sequence_Interest_Allocation.png" alt="Sequence Interest Allocation"><div class="image-caption">Sơ đồ 9/12: VA Hierarchy & Management (Click để phóng to)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Cấu trúc VA Mẹ/Con</p>
            <p>VA Engine hỗ trợ mô hình VA có cấu trúc phân cấp để quản lý dòng tiền theo trung tâm chi phí/đơn vị thành viên (VA Con) dựa trên một tài khoản Core Banking thật duy nhất (VA Mẹ).</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">VA Mẹ (Mother VA):</span> Ánh xạ trực tiếp tới một tài khoản DDA tại Core Banking. Giữ sổ cái thật.</li>
                <li><span class="font-bold">VA Con (Child VA):</span> Có sổ cái ảo (shadow ledger) trong VA DB.</li>
                <li><span class="font-bold text-red-700">Quy tắc then chốt:</span> Tổng số dư thực (Real Balance) của tất cả VA Con phải bằng (=) Số dư thực tế (Actual Balance) của tài khoản DDA tại Core.</li>
            </ul>
        </div>
    </div>

    <!-- ==================================================================================== -->
    <!-- CONTENT ENGLISH (TRANSLATED) -->
    <!-- ==================================================================================== -->
    <div id="content-en" class="hidden">
        <header class="text-center py-6">
            <h1 class="main-header justify-center">Virtual Account (VA) System Architecture</h1>
        </header>

        <!-- SUMMARY BLOCK -->
        <div class="summary-block">
            <div class="summary-title">KNOWLEDGE SUMMARY OF 12 ARCHITECTURE & PROCESS DIAGRAMS</div>
            <p class="text-gray-700 mb-4">
                The 12 diagrams are divided into <strong>2 main groups</strong> based on their purpose:
            </p>
            
            <div class="group-title text-indigo-700">I. Group 1 – Macro Architecture Diagrams</div>
            <p class="text-sm text-gray-600 italic">Includes 4 diagrams: Diagram #1, #2, #10, #11</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Group Objective</p>
                <ul class="diagram-list">
                    <li>Present the overall system landscape.</li>
                    <li>Show the boundaries between Core Banking and Deposit Core Hub.</li>
                    <li>Serve as a basis for approval by the Architecture Council and Management.</li>
                    <li>Help all technical teams (Core, Integration, Digital Channels, BA/Dev/QA) understand system operations at an architectural level.</li>
                </ul>
                <p class="font-medium mt-2">2. List of Diagrams</p>
                <ul class="diagram-list">
                    <li><span class="font-semibold text-green-700">Diagram #1 – Overall System Landscape / Core Banking Super Layer:</span> Introduces the BIG PICTURE. Layers: Channels → API Gateway → Routing Hub → Deposit Core Hub → Core Banking → Data Layer. Specifies where VA belongs and what Core does. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Diagram #2 – Logical Architecture (Deposit Core Hub + VA):</span> Describes key modules: Routing Hub, VA Engine, DDA Handler, Interest Engine. Logical boundary between Hub and Core. Explains component responsibilities. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Diagram #10 – Data Model VA (ERD):</span> Conceptual ERD: VA, VA Ledger, VA Balance, Hierarchy, Enrollment, Identifier… Shows data organization. Must-have.</li>
                    <li><span class="font-semibold text-green-700">Diagram #11 – Detailed Logical ERD:</span> In-depth version of the conceptual ERD (#10). Fully shows relationships between tables and logic modules. Highly useful for Data, BA, and Dev teams. Should-have.</li>
                </ul>
            </div>

            <div class="group-title text-indigo-700">II. Group 2 – Logical Architecture & Business Flow Diagrams</div>
            <p class="text-sm text-gray-600 italic">Includes 8 diagrams: #3 → #9 + #12 (Note: #7, #8, #9 are Sequence Diagrams)</p>
            <div class="text-gray-700">
                <p class="font-medium mt-2">1. Group Objective</p>
                <ul class="diagram-list">
                    <li>Detail each business flow that Virtual Account must support.</li>
                    <li>Demonstrate interactions between system components.</li>
                    <li>Assist BA/Dev/QA teams in building, testing, and reporting.</li>
                    <li>Ensure business cases meet international VA standards.</li>
                </ul>
                <p class="font-medium mt-2">2. List of Diagrams</p>
                <ul class="diagram-list">
                    <li><span class="font-semibold text-red-700">Diagram #3 – VA-first Incoming Flow:</span> Flow when customer inputs VA number directly. Routing → Validate VA → Core posting → Event → Shadow Posting. International standard, ensures no lost transactions. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #4 – DDA-first Incoming Flow:</span> When customer inputs DDA number + remark. Core credits first → Routing Hub finds VA → VA shadow posting. Supports legacy interbank channels. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #5 – Outgoing from VA:</span> VA checks balance → Shadow Debit → Core Debit DDA → Confirm. Fits POBO, paying on behalf, transfer from VA. Must-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #6 – Interest Allocation Flow:</span> Core calculates interest on DDA → Routing Hub → VA Alloc Engine → Shadow Posting. Supports interest splitting by project/household/unit. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #7 – Sequence VA-first:</span> Sequence Diagram describing interactions for Diagram #3. Serves Dev/QA for API building & error handling. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #8 – Sequence Outgoing VA:</span> Full outgoing logic sequence for Diagram #5. Helps tech team control pending/confirmed debits. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #9 – Sequence Interest Allocation:</span> Details of interest calculation and allocation for Diagram #6. Supports audit & reconciliation. Should-have.</li>
                    <li><span class="font-semibold text-red-700">Diagram #12 – Integration & Deployment Architecture:</span> Describes actual deployment: containers, scaling, HA/DR. Critical for DevOps/Infra. Must-have.</li>
                </ul>
            </div>
        </div>

        <h2 class="sub-header">
            <i data-lucide="layout-grid" class="w-6 h-6 text-blue-500"></i>
            I. Group 1 – Macro Architecture Diagrams
        </h2>
        <p class="pl-2 text-gray-700 italic">These diagrams present the overall system landscape, logical architecture, and data layer (Diagrams #1, #2, #10, #11).</p>

        <!-- Diagram 1 -->
        <div class="section-header">1. Diagram #1 – Overall System Landscape / Core Banking Super Layer</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/01_Overall_System_Landscape.png" alt="Overall System Landscape">
            <div class="image-caption">Diagram 1/12: Overall System Landscape / Core Banking Super Layer (Click to zoom)</div>
        </div>
        
        <div class="mt-8 space-y-8">
            <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600 shadow-sm">
                <h3 class="text-xl font-bold text-blue-800 uppercase mb-3 flex items-center gap-2">
                    <i data-lucide="target" class="w-6 h-6"></i> Architecture Objectives
                </h3>
                <p class="mb-4 text-gray-800">
                    The <span class="font-bold text-blue-700">“Core Banking Super Layer”</span> model helps the bank separate the core accounting layer from attached service layers, enabling rapid new product development without direct impact on the Core. This architecture aims to:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="flex items-start gap-2"><i data-lucide="shield-check" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Protect Core Banking from high load and change risks</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="settings-2" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Standardize communication points: Channel – System – Core</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="zap" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Accelerate product innovation (Virtual Account, Alias Account, Fee Engine…)</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="trending-up" class="w-5 h-5 text-blue-600 mt-1 flex-shrink-0"></i><span class="text-gray-700 font-medium">Enhance corporate experience and competitiveness</span></div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Main Architecture Layers</h3>
                <div class="space-y-3">
                    <div class="bg-white border border-gray-200 rounded-md p-4 flex flex-col md:flex-row gap-4 hover:shadow-md transition">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-700">Channel Layer</span>
                            <div class="font-bold text-lg text-gray-900">Channel Layer</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-100 pl-0 md:pl-4">
                            <p class="mb-1">Includes iBank, H2H, Mobile, Teller, interbank channels…</p>
                            <p class="text-sm italic text-gray-500">→ Sends all transactions via API Gateway, no direct connection to Core.</p>
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-md p-4 flex flex-col md:flex-row gap-4 hover:shadow-md transition">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-700">Integration</span>
                            <div class="font-bold text-lg text-gray-900">API Gateway / ESB</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-100 pl-0 md:pl-4">
                            <p class="mb-1">Performs orchestration, authentication, protects Core from direct access.</p>
                            <p class="text-sm font-semibold text-blue-600">→ The “single door” for all deposit transactions.</p>
                        </div>
                    </div>
                    <div class="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-5 flex flex-col gap-4 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-indigo-500 text-white text-xs font-bold px-2 py-1 rounded-bl">SUPER LAYER</div>
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="md:w-1/4">
                                <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-indigo-100 text-indigo-800">Core Hub</span>
                                <div class="font-bold text-xl text-indigo-900 mt-1">Deposit Core Hub</div>
                                <p class="text-sm text-indigo-700 mt-2">This is the critical layer, sitting between channels and Core.</p>
                            </div>
                            <div class="md:w-3/4 border-l-2 border-indigo-200 pl-0 md:pl-4">
                                <p class="font-semibold text-indigo-900 mb-2">Main Functions:</p>
                                <ul class="space-y-2 text-gray-700">
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>Routing Hub:</strong> Orchestrates flows: credit, debit, VA-first, DDA-first</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>VA Engine:</strong> Manages Virtual Accounts, shadow posting, real/roll-up balances</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>Interest Allocation:</strong> Allocates interest from DDA to VAs</span></li>
                                    <li class="flex items-start gap-2"><div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></div><span><strong>DDA Handler:</strong> Handles transactions posting to DDA with extended logic</span></li>
                                </ul>
                                <p class="mt-3 text-sm font-medium text-indigo-800 bg-indigo-100 p-2 rounded">→ Enables new feature development without modifying Core, reducing risk and speeding up deployment.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-50 border border-slate-300 rounded-md p-4 flex flex-col md:flex-row gap-4">
                        <div class="md:w-1/4">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-slate-200 text-slate-700">Backend</span>
                            <div class="font-bold text-lg text-slate-900">Core Banking Layer</div>
                        </div>
                        <div class="md:w-3/4 text-gray-600 border-l md:border-gray-200 pl-0 md:pl-4">
                            <p class="mb-2 italic">Core performs only accounting and real posting tasks:</p>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Credit/Debit DDA</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Calculate Real Interest</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Publish Events (posting)</div>
                                <div class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-slate-500"></i> Ensure Ledger Integrity</div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pt-2">
                        <div class="bg-orange-50 border border-orange-200 rounded p-3">
                            <div class="font-bold text-orange-800 mb-1 flex items-center gap-2"><i data-lucide="activity" class="w-4 h-4"></i> Event Bus</div>
                            <p class="text-sm text-gray-700">Provides asynchronous mechanism to sync transactions between Core and Super Layer.</p>
                            <p class="text-xs text-orange-600 mt-1 font-semibold">→ Increases scalability, reduces congestion.</p>
                        </div>
                        <div class="bg-cyan-50 border border-cyan-200 rounded p-3">
                            <div class="font-bold text-cyan-800 mb-1 flex items-center gap-2"><i data-lucide="database" class="w-4 h-4"></i> Data Layer</div>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li><strong>Core DB:</strong> DDA ledger – standard audit ledger</li>
                                <li><strong>VA DB:</strong> VA ledger (shadow), registry, mapping</li>
                            </ul>
                            <p class="text-xs text-cyan-600 mt-1 font-semibold">→ Decoupled for stable Core and flexible VA.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-emerald-800 mb-4 flex items-center gap-2 border-b-2 border-emerald-100 pb-2">
                    <i data-lucide="thumbs-up" class="w-6 h-6"></i> Overall Benefits for the Bank
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Protect Core – Reduce Risk</h4><p class="text-sm text-gray-600">Minimal Core changes avoid upgrade impacts and error risks.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Open Platform for New Products</h4><p class="text-sm text-gray-600">Virtual Account, Alias, Fee Engine… deploy fast, zero touch on Core.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Increase Performance & Scale</h4><p class="text-sm text-gray-600">Super Layer handles high volume business logic, Core focuses on ledger → better performance.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500"><h4 class="font-bold text-gray-800 mb-2">Standardize Omnichannel Integration</h4><p class="text-sm text-gray-600">Transactions follow unified flow, easy to operate and control.</p></div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-t-4 border-emerald-500 lg:col-span-2"><h4 class="font-bold text-gray-800 mb-2">Tech Model Upgrade</h4><p class="text-sm text-gray-600">Approaching international banking architecture: layered, event-driven, microservices.</p></div>
                </div>
            </div>

            <div class="bg-gray-800 text-white rounded-lg p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-3 flex items-center gap-2 text-yellow-400"><i data-lucide="flag" class="w-6 h-6"></i> Strategic Conclusion</h3>
                <p class="mb-4 text-gray-300">The Core Banking Super Layer architecture not only solves current needs (VA, Cash Management) but is also a long-term foundation for digital transformation, helping BIDV:</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Reduce Dependency</div><div class="text-xs text-gray-400">on Core vendor</div></div>
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Proactively Expand</div><div class="text-xs text-gray-400">products per market needs</div></div>
                    <div class="bg-gray-700 p-3 rounded text-center border border-gray-600"><div class="font-bold text-white">Operational Stability</div><div class="text-xs text-gray-400">at critical system level</div></div>
                </div>
                <p class="text-sm text-gray-400 italic text-center border-t border-gray-700 pt-3">"This model is suitable for banks wanting to strongly develop corporate transaction services and expand digital banking platforms"</p>
            </div>
        </div>

        <!-- Diagram 2 -->
        <div class="section-header">2. Diagram #2 – Logical Architecture (Deposit Core Hub + VA)</div>
        <div class="image-container">
            <img class="zoomable-image" src="./Picture/02_Logical_Architecture_DepositCoreHub_VA.png" alt="Logical Architecture">
            <div class="image-caption">Diagram 2/12: Logical Architecture (Deposit Core Hub + VA) (Click to zoom)</div>
        </div>
        <div class="mt-6 space-y-6">
            <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500 text-gray-700">
                <p>This diagram describes the logical architecture of the <span class="font-bold text-indigo-700">Deposit Core Hub</span> layer – a "super business layer" built around the Core Banking Deposit Module, allowing BIDV to rapidly develop modern payment products, especially <span class="font-bold">Virtual Account (VA)</span>, without modifying the Core.</p>
            </div>
            <h3 class="font-bold text-xl text-gray-800 border-b border-gray-200 pb-2">4 Key Capability Blocks</h3>
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-3"><div class="bg-purple-100 p-2 rounded-full text-purple-600"><i data-lucide="route" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-purple-900">Routing Hub – The Brain of Routing & Control</h4></div>
                <p class="text-gray-600 mb-3 italic">Acts as a mandatory intermediate point for all payment transactions using VA.</p>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Check transaction type: <span class="font-medium">VA-first</span> or <span class="font-medium">DDA-first</span>.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Call VA Engine to validate VA number before sending to Core.</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Identify corresponding Real DDA (Mapped DDA).</span></li>
                    <li class="flex gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-purple-500 mt-1 flex-shrink-0"></i> <span>Receive events from Core to forward to VA Engine for shadow ledger update.</span></li>
                </ul>
                <div class="mt-3 text-sm font-medium text-purple-800 bg-purple-50 p-2 rounded border border-purple-100">→ Separates extended business logic from Core, ensuring unified processing flow for all channels.</div>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition">
                <div class="flex items-center gap-3 mb-4"><div class="bg-blue-100 p-2 rounded-full text-blue-600"><i data-lucide="cpu" class="w-6 h-6"></i></div><h4 class="text-lg font-bold text-blue-900">Virtual Account Engine – The Heart of VA Business</h4></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Incoming Service</div><p class="text-xs text-gray-600">Receives incoming transaction, validates VA, finds Mapped DDA, returns result to Routing Hub.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Outgoing Service</div><p class="text-xs text-gray-600">Processes payout order, checks real/roll-up balance, records shadow debit, calls Core for real DDA debit.</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">Shadow Posting Engine</div><p class="text-xs text-gray-600">Creates virtual entries; updates VA balance and roll-up balance across multi-level VA tree (3–5 levels).</p></div>
                    <div class="bg-blue-50 p-3 rounded border border-blue-100"><div class="font-bold text-blue-800 text-sm mb-1">VA Balance Engine</div><p class="text-xs text-gray-600">Calculates instant balance, synchronizes with Shadow Ledger and Core events.</p></div>
                </div>
                <p class="mt-4 text-sm text-blue-800 font-medium px-2">→ VA Engine operates independently from Core, providing flexibility to expand features without impacting the core system.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-slate-800 font-bold"><i data-lucide="server" class="w-5 h-5"></i> Core Banking Layer</div>
                    <p class="text-xs text-slate-500 mb-2 uppercase font-bold tracking-wide border-b border-slate-200 pb-1">Place for Real Posting</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Deposit Module:</strong> real accounting on DDA.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <span><strong>Event Bus:</strong> emits “Credit/Debit Notification” whenever Core completes a transaction.</span></li>
                    </ul>
                    <div class="text-xs italic text-slate-600 bg-white p-2 rounded border border-slate-100">Core only performs accounting tasks; all orchestration, mapping, reconciliation, and virtual processing logic reside in Deposit Core Hub.</div>
                </div>
                <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-4 h-full">
                    <div class="flex items-center gap-2 mb-2 text-cyan-800 font-bold"><i data-lucide="database" class="w-5 h-5"></i> Data Layer</div>
                    <p class="text-xs text-cyan-600 mb-2 uppercase font-bold tracking-wide border-b border-cyan-200 pb-1">Decoupled Real & Virtual Ledgers</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-3">
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>Core Ledger:</strong> real balance and transactions of DDA.</span></li>
                        <li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"></span> <span><strong>VA Ledger (Shadow):</strong> virtual entries for each VA and hierarchy level.</span></li>
                    </ul>
                    <div class="text-xs italic text-cyan-700 bg-white p-2 rounded border border-cyan-100">This separation allows flexible VA expansion without risking Core Banking stability.</div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-5 shadow-sm">
                <h4 class="text-green-800 font-bold text-lg mb-3 flex items-center gap-2"><i data-lucide="gem" class="w-5 h-5"></i> Architecture Value Summary</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Decouple business logic from Core, reducing load and changes to core system.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Support two transaction models: VA-first and DDA-first.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Ensure real-time operation, transparency, and easy control.</span></div>
                    <div class="flex gap-2 items-start"><i data-lucide="check" class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"></i> <span>Create foundation for new products: Collection/Payout, Pooling, Cash Flow Management.</span></div>
                </div>
                <div class="mt-4 pt-3 border-t border-green-200 text-center text-green-900 font-bold italic text-sm">"This is a breakthrough architecture, helping BIDV modernize the deposit module and prepare for digital transaction banking strategy."</div>
            </div>
        </div>

        <!-- Diagram 10 -->
        <div class="section-header">3. Diagram #10 – Data Model VA (ERD)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/10_Data_Model_VA_Conceptual.png" alt="Data Model VA (ERD)"><div class="image-caption">Diagram 10/12: Data Model VA (ERD) & Data Flow (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Decoupled Data Layer Architecture</p>
            <p>The data architecture is completely decoupled. This diagram shows the overview ERD structure, including tables for VA, VA Ledger, VA Balance, Hierarchy, and relationships with DDA.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Core Banking DB:</span> Contains <span class="text-green-700 font-bold">DDA ledger (real ledger)</span>, the single source of truth for auditing.</li>
                <li><span class="font-bold">VA DB:</span> Contains <span class="text-green-700 font-bold">VA ledger (shadow ledger)</span>, registry, mapping (VA-DDA), and business rules. Optimized for lookup speed.</li>
                <li><span class="font-bold">Reporting DB / Data Mart:</span> Aggregated data from both Core and VA to serve BI/Reporting without impacting transaction performance.</li>
            </ul>
        </div>

        <!-- Diagram 11 -->
        <div class="section-header">4. Diagram #11 – Deployment Architecture</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/11_Logical_ERD_VA_Detail.png" alt="Logical ERD Detail"><div class="image-caption">Diagram 11/12: Deployment Architecture (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Modern Deployment Model (Deployment & Integration)</p>
            <p>Deposit Core Hub (Super Layer) is deployed on a modern platform, separated from the traditional Core Banking environment. This diagram details deployment and operation.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Containerized:</span> Using Docker/Kubernetes for VA Engine & Routing Hub.</li>
                <li><span class="font-bold">Independent Scaling:</span> Ability to scale independently per microservice (Incoming Flow, Outgoing Flow, Lookup Services...).</li>
                <li><span class="font-bold">Zero-downtime deployment:</span> Applying Rolling Update or Blue/Green strategies.</li>
                <li><span class="font-bold">HA & DR:</span> Deployed as Multinode Cluster (High Availability) and synced with DR Site (Disaster Recovery).</li>
            </ul>
        </div>

        <!-- Diagram 12 -->
        <div class="section-header">5. Diagram #12 – Integration & Deployment Architecture</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/12_Integration_Deployment_VA_DepositCoreHub.png" alt="Integration & Deployment"><div class="image-caption">Diagram 12/12: Integration Architecture (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Asynchronous Integration Mechanism (Event-Driven)</p>
            <p>Event-Driven integration architecture (based on Event Bus like Kafka) is key to achieving performance and stability, reducing synchronous dependency between Core and Super Layer.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Core to Super Layer:</span> Core Banking publishes events (posting, interest) to Event Bus after completing real DDA accounting.</li>
                <li><span class="font-bold">Super Layer Listener:</span> VA Engine listens to events. Only upon receiving confirmation event (Success Credit/Debit) from Core, VA Engine proceeds to Credit/Debit the <span class="text-indigo-700 font-semibold">VA Ledger (shadow ledger)</span>.</li>
                <li><span class="font-bold">Guarantee:</span> <span class="font-semibold text-red-700">At-least-once delivery</span> mechanism and retry to maintain transaction integrity.</li>
            </ul>
        </div>

        <h2 class="sub-header"><i data-lucide="trello" class="w-6 h-6 text-indigo-500"></i> II. Group 2 – Logical Architecture & Business Flow Diagrams</h2>
        <p class="pl-2 text-gray-700 italic">These diagrams detail each business flow, including transaction flows, VA management, and reconciliation (Diagrams #3 $\to$ #9).</p>

        <!-- Diagram 3 -->
        <div class="section-header">6. Diagram #3 – Flow #1: VA-first Incoming (Credit to VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/03_Flow_VA_First_Incoming.png" alt="VA-first Incoming Flow"><div class="image-caption">Diagram 3/12: VA-first Incoming Flow (Credit to VA) (Click to zoom)</div></div>
        <div class="mt-6 space-y-6">
            <div class="bg-blue-50 p-4 rounded-lg text-gray-700 border border-blue-100 shadow-sm italic">
                <p>This diagram describes the processing flow when a customer actively enters a <span class="font-semibold text-blue-700">Virtual Account (VA)</span> number on transaction channels (Internet Banking, H2H, API, Counter…). This is the international standard model (“VA-first”), ensuring transactions are validated at the start, reducing errors and investigation costs.</p>
            </div>
            <div class="space-y-4">
                <!-- Step 1 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">1</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Channel sends request via VA number</h4><p class="text-sm text-gray-600 mb-2">Customer inputs VA number directly instead of real DDA number.</p><ul class="text-xs text-gray-500 list-disc ml-4"><li>Info: VA Number, Amount, Sender/Receiver, Reference, Invoice...</li><li class="italic text-blue-600 mt-1">→ Channel does not process, forwards entire request to Routing Hub.</li></ul></div>
                </div>
                <!-- Step 2 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">2</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub sends validation request to VA Engine</h4><p class="text-sm text-gray-600 mb-2">Routing Hub acts as business "gatekeeper":</p><ul class="text-xs text-gray-500 list-disc ml-4 space-y-1"><li>Calls Validate VA service at VA Engine.</li><li>Checks: Existence, Status (Active/Locked), Constraints (Collection/Payment/Limits).</li><li>Identifies <span class="font-semibold text-gray-700">Mapped DDA</span> – real account linked to VA.</li></ul><div class="flex gap-2 mt-2 text-xs font-semibold"><span class="text-red-600 bg-red-50 px-2 py-1 rounded">Invalid → Return Error</span><span class="text-green-600 bg-green-50 px-2 py-1 rounded">Valid → Get DDA & Continue</span></div></div>
                </div>
                <!-- Step 3 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">3</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub posts Credit to DDA via Core Banking</h4><p class="text-sm text-gray-600">Routing Hub uses Mapped DDA to call Core:</p><ul class="text-xs text-gray-500 list-disc ml-4 mt-1"><li>Executes Credit to DDA (real posting).</li><li>Records entry in Core.</li><li>Checks limits, status of real account.</li></ul></div>
                </div>
                <!-- Step 4 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">4</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Core Banking publishes Credit Notification event</h4><p class="text-sm text-gray-600">After successful posting, Core emits event to Event Bus:</p><div class="mt-2 text-xs bg-gray-50 p-2 rounded border text-gray-600 font-mono">{ Type, New Balance, Amount, Txn ID, DDA }</div><p class="text-xs text-gray-500 mt-1 italic">→ Event forwarded to Routing Hub for VA processing.</p></div>
                </div>
                <!-- Step 5 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">5</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">Routing Hub notifies Post-Notification to VA Engine</h4><p class="text-sm text-gray-600">Confirms Core posting success & sends info for VA ledger recording.</p><p class="text-xs text-indigo-600 font-semibold mt-1 bg-indigo-50 inline-block px-2 py-1 rounded">Ensures: No pre-posting - No double posting - Only post when Core succeeds.</p></div>
                </div>
                <!-- Step 6 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">6</div>
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex-1 hover:shadow-md transition"><h4 class="font-bold text-gray-900 mb-1">VA Engine records Shadow Posting & updates balance</h4><div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2"><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>1. Create Shadow Posting (Credit)</strong><br>Save to VA Ledger.</div><div class="text-xs text-gray-600 bg-gray-50 p-2 rounded border"><strong>2. Update Balance</strong><br>Receiving VA & Parent Roll-up balance.</div></div><p class="text-xs text-gray-500 mt-2 italic">Idempotency ensures each Core txn corresponds to exactly 1 shadow posting.</p></div>
                </div>
                <!-- Step 7 -->
                <div class="flex gap-4">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">7</div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm flex-1"><h4 class="font-bold text-green-900 mb-1">Transaction Flow Completed</h4><ul class="text-sm text-green-800 list-disc ml-4"><li>Core Ledger & VA Shadow Ledger updated.</li><li>VA Balances synchronized near real-time.</li><li>Transaction displayed correctly to customer at VA level.</li></ul></div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-emerald-50 to-green-50 border-l-4 border-emerald-500 p-5 rounded-r-lg shadow-sm">
                <h4 class="font-bold text-emerald-800 text-lg mb-3 flex items-center gap-2"><i data-lucide="award" class="w-6 h-6"></i> Value of VA-first Flow</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-700">
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>No “Lost VA” transactions:</strong> VA validated before Core entry.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Fast Reconciliation:</strong> VA knows exactly who the transaction belongs to.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Operational Cost Savings:</strong> Reduces manual investigation.</span></div>
                    <div class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-600 mt-0.5"></i><span><strong>Flexible Expansion:</strong> No logic modification required at Core.</span></div>
                </div>
                <p class="mt-3 text-emerald-900 font-semibold italic text-sm text-center border-t border-emerald-200 pt-2">"This flow is the main pillar in Deposit Core Hub design and BIDV's Virtual Account solution"</p>
            </div>
        </div>

        <!-- Diagram 4 -->
        <div class="section-header">7. Diagram #4 – VA-first Incoming Flow (Credit to VA)</div>
        <p class="text-gray-700 italic">Processing flow for Credit transactions to VA when VA is directly identified.</p>
        <div class="image-container"><img class="zoomable-image" src="./Picture/04_Flow_DDA_First_Incoming.png" alt="DDA-first Incoming Flow"><div class="image-caption">Diagram 4/12: VA-first Incoming Flow (Credit to VA) (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">VA-first Credit Transaction Process</p>
            <p>This is the international standard flow where VA is used as the destination account:</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Routing & Mapping:</span> Routing Hub identifies VA account and maps to corresponding real DDA at Core.</li>
                <li><span class="font-bold">2. Core Posting:</span> Executes <span class="text-green-700 font-semibold">Credit</span> transaction to real DDA account at Core Banking.</li>
                <li><span class="font-bold">3. Event & Shadow Posting:</span> Core emits event. VA Engine listens and Credits the <span class="text-indigo-700 font-semibold">VA Ledger (shadow ledger)</span>.</li>
            </ul>
        </div>

        <!-- Diagram 5 -->
        <div class="section-header">8. Diagram #5 – Outgoing from VA (Debit from VA)</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/05_Flow_Outgoing_From_VA.png" alt="Outgoing from VA"><div class="image-caption">Diagram 5/12: Outgoing Transaction Flow (Debit from VA) (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">VA-first Rule for Debit</p>
            <p>Debit transactions must follow VA-first rule to ensure VA does not have negative shadow balance and real DDA has sufficient funds:</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. VA Engine Validation:</span> VA Engine checks <span class="text-red-700 font-semibold">Available Balance</span> of VA in shadow ledger. If insufficient, reject immediately.</li>
                <li><span class="font-bold">2. Core Posting:</span> If sufficient, Core Banking executes <span class="text-red-700 font-semibold">Debit</span> transaction on real DDA account.</li>
                <li><span class="font-bold">3. Event & Shadow Posting:</span> Core emits event. VA Engine Debits the <span class="text-indigo-700 font-semibold">VA Ledger (shadow ledger)</span>.</li>
            </ul>
        </div>

        <!-- Diagram 6 -->
        <div class="section-header">9. Diagram #6 – Interest Allocation Flow</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/06_Flow_Interest_Allocation.png" alt="Interest Allocation Flow"><div class="image-caption">Diagram 6/12: Interest Allocation Flow (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Interest/Fee Allocation</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Core Banking:</span> Calculates interest and posts interest/fee to <span class="text-green-700 font-semibold">Real DDA</span>, then emits event (interest/fee event).</li>
                <li><span class="font-bold">2. VA Engine (Interest Allocation):</span> Listens to event. Executes business logic to allocate interest/fee received from real DDA down to each Child VA (based on average balance ratio).</li>
                <li><span class="font-bold">3. Shadow Posting:</span> Credits (interest) or Debits (fee) to <span class="text-indigo-700 font-semibold">VA Ledger</span> of each Child VA.</li>
            </ul>
        </div>

        <!-- Diagram 7 -->
        <div class="section-header">10. Diagram #7 – Reconciliation Mechanism</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/07_Sequence_VA_First.png" alt="Sequence VA First"><div class="image-caption">Diagram 7/12: Reconciliation Mechanism (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Ensuring Ledger Synchronization</p>
            <p>Since transactions are processed asynchronously, an automated reconciliation mechanism is mandatory.</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">1. Event-based Reconciliation:</span> Each event from Core Banking (DDA Credit/Debit) must have a corresponding entry in VA Ledger.</li>
                <li><span class="font-bold">2. Periodic Reconciliation (EOD):</span> Verify <span class="text-red-700 font-semibold">Total Real Balance of all Child VAs = Actual DDA Balance at Core</span>.</li>
                <li><span class="font-bold">3. Discrepancy Handling:</span> Automatically alert and trigger adjustment process if discrepancies occur.</li>
            </ul>
        </div>

        <!-- Diagram 8 -->
        <div class="section-header">11. Diagram #8 – VA Lifecycle</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/08_Sequence_Outgoing_VA.png" alt="Sequence Outgoing VA"><div class="image-caption">Diagram 8/12: VA Lifecycle (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">VA States and State Transitions</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold text-green-700">Created:</span> VA created but not yet active.</li>
                <li><span class="font-bold text-green-700">Active:</span> Ready for Credit/Debit transactions.</li>
                <li><span class="font-bold text-red-700">Inactive/Frozen:</span> VA temporarily locked (may allow Credit, deny Debit).</li>
                <li><span class="font-bold text-red-700">Closed:</span> VA permanently closed, no transactions allowed.</li>
            </ul>
        </div>
        
        <!-- Diagram 9 -->
        <div class="section-header">12. Diagram #9 – VA Hierarchy & Management</div>
        <div class="image-container"><img class="zoomable-image" src="./Picture/09_Sequence_Interest_Allocation.png" alt="Sequence Interest Allocation"><div class="image-caption">Diagram 9/12: VA Hierarchy & Management (Click to zoom)</div></div>
        <div class="space-y-4 text-gray-700 mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <p class="font-bold text-lg text-blue-800">Mother/Child VA Structure</p>
            <p>VA Engine supports hierarchical VA models to manage cash flow by cost center/member unit (Child VA) based on a single real Core Banking account (Mother VA).</p>
            <ul class="list-disc ml-8 space-y-1">
                <li><span class="font-bold">Mother VA:</span> Maps directly to a DDA account at Core Banking. Holds the real ledger.</li>
                <li><span class="font-bold">Child VA:</span> Has a shadow ledger in VA DB.</li>
                <li><span class="font-bold text-red-700">Key Rule:</span> Total Real Balance of all Child VAs must equal (=) Actual Balance of DDA account at Core.</li>
            </ul>
        </div>
    </div>

    <footer class="text-center mt-10 pt-4 border-t border-gray-200 text-gray-500 text-sm">
        Virtual Account System Architecture Document.
        <script>
            lucide.createIcons();
        </script>
    </footer>

</div>

<!-- The Modal -->
<div id="myModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>

<script>
    // --- LANGUAGE SWITCHING LOGIC (From GuideContent.html) ---
    function setLanguage(lang) {
        const vi = document.getElementById('content-vi');
        const en = document.getElementById('content-en');
        
        if (!vi || !en) {
            console.warn("Elements not found, retrying...");
            return;
        }

        if (lang === 'en') {
            vi.classList.add('hidden');
            en.classList.remove('hidden');
        } else {
            vi.classList.remove('hidden');
            en.classList.add('hidden');
        }
    }

    // 1. Check URL Param on load
    const urlParams = new URLSearchParams(window.location.search);
    const initialLang = urlParams.get('lang') || 'vi';
    setLanguage(initialLang);

    // 2. Listen for messages from parent App (if embedded)
    window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'SET_LANG') {
            setLanguage(event.data.lang);
        }
    });

    // --- ZOOM IMAGE LOGIC ---
    var modal = document.getElementById("myModal");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    var span = document.getElementsByClassName("close")[0];

    // Delegate click event for images since some might be hidden initially or loaded dynamically
    document.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('zoomable-image')) {
            modal.style.display = "block";
            modalImg.src = e.target.src;
            captionText.innerHTML = e.target.alt;
        }
    });

    span.onclick = function() { 
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
